import{d as B,r as N,x as D,c as A,w as L,y as M,b as y,o as m,e as _,g as a,i as u,z as C,f as p,_ as g,j as h,k as P,u as d,W as f,p as z,F as O,m as T,t as k,l as w}from"./app-0hD9jktS.js";import{_ as W}from"./AppLayout.vue_vue_type_script_setup_true_lang-C_OfVMdc.js";import{_ as x,a as S}from"./SelectInput-C8qFFp1m.js";import{P as E}from"./plus-DX8dkZyx.js";import"./RovingFocusGroup-BrsbekXI.js";import"./AvatarImage.vue_vue_type_script_setup_true_lang-DLhJV-ve.js";import"./AppLogo.vue_vue_type_script_setup_true_lang-DV00-4L5.js";import"./building-2-0J7JWYjO.js";import"./users-CQiJNf1m.js";import"./school-SWVnhMs_.js";import"./chevron-down-Bc9-FnA7.js";import"./check-DytFQTDT.js";import"./Label.vue_vue_type_script_setup_true_lang-CLv8w6I-.js";import"./Input.vue_vue_type_script_setup_true_lang-ByoFr_iA.js";import"./InputError.vue_vue_type_script_setup_true_lang-BnFbo3YU.js";const q={class:"max-w-7xl mx-auto w-full px-4 py-10"},G={class:"bg-white dark:bg-neutral-900 rounded-lg shadow-md p-6"},H={class:"flex items-center justify-between mb-6"},J={key:0,class:"text-center flex flex-col items-center gap-4 my-6 p-6 bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-300 dark:border-yellow-700 rounded-lg"},K={key:1,class:"text-center flex flex-col items-center gap-4 my-6 p-6 bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-300 dark:border-yellow-700 rounded-lg"},Q={class:"grid grid-cols-1 md:grid-cols-4 gap-4"},X={key:0,class:"overflow-x-auto mt-6"},Y={class:"w-full table-auto border-collapse"},Z={class:"p-2 text-sm"},ee={class:"p-2 text-sm"},se={class:"p-2"},te={class:"p-2"},ae={class:"p-2"},le={class:"p-2"},oe={class:"p-2"},re={class:"p-2 text-sm"},de=["onChange"],ne={key:0,class:"text-xs text-gray-500 mt-1"},ie={key:1,class:"text-center py-4 px-4 bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-300 dark:border-yellow-700 rounded-lg"},me={class:"flex justify-end space-x-3 mt-6"},pe={key:0},ue={key:1},ce={key:2},$e=B({__name:"Create",props:{schools:{},classes:{},students:{},examPapers:{},selectedSchoolId:{},selectedClassId:{},selectedExamPaperId:{},noExamExists:{type:Boolean},noExamPapers:{type:Boolean}},setup($){const n=$,V=N({}),t=D({school_id:n.selectedSchoolId?String(n.selectedSchoolId):"",class_id:n.selectedClassId?String(n.selectedClassId):"",exam_paper_id:n.selectedExamPaperId?String(n.selectedExamPaperId):"",results:n.students.map(l=>({student_id:l.id,obtained_marks:"",total_marks:"100",status:"pass",promotion_status:"pending",remarks:""}))}),v=A(()=>t.errors);function U(l,e){const s=l.target.files;if(s&&s.length>0){const r=Array.from(s);t.results[e].images=r,V.value[e]=r.map(c=>URL.createObjectURL(c))}else t.results[e].images=[],V.value[e]=[]}function I(){t.class_id="",t.exam_paper_id="",f.get(route("exam-results.create"),{school_id:t.school_id},{preserveState:!0,preserveScroll:!0,replace:!0})}function F(){t.exam_paper_id="",f.get(route("exam-results.create"),{school_id:t.school_id,class_id:t.class_id},{preserveState:!0,preserveScroll:!0,replace:!0})}function R(){f.get(route("exam-results.create"),{school_id:t.school_id,class_id:t.class_id,exam_paper_id:t.exam_paper_id},{preserveState:!0,preserveScroll:!0,replace:!0})}function j(){let l=!0;if(t.results.forEach(o=>{(!o.obtained_marks||!o.total_marks)&&(l=!1,w.error("Please enter all required marks."))}),!l)return;const e=new FormData;e.append("school_id",t.school_id),e.append("class_id",t.class_id),e.append("exam_paper_id",t.exam_paper_id),t.results.forEach((o,s)=>{var r;e.append(`results[${s}][student_id]`,String(o.student_id)),e.append(`results[${s}][obtained_marks]`,o.obtained_marks),e.append(`results[${s}][total_marks]`,o.total_marks),e.append(`results[${s}][status]`,o.status),e.append(`results[${s}][promotion_status]`,o.promotion_status),e.append(`results[${s}][remarks]`,o.remarks),(r=o.images)!=null&&r.length&&o.images.forEach((c,i)=>{e.append(`results[${s}][images][${i}]`,c)})}),f.post(route("exam-results.store"),e,{forceFormData:!0,onSuccess:()=>w.success("Results saved successfully!"),onError:o=>{Object.values(o).flat().forEach(s=>{typeof s=="string"&&w.error(s)})}})}L(()=>n.students,l=>{t.results=l.map(e=>({student_id:e.id,obtained_marks:"",total_marks:"100",status:"pass",promotion_status:"pending",remarks:"",images:[]}))},{immediate:!0});function b(l,e){const o=`results.${l}.${e}`;return t.errors[o]}return(l,e)=>{const o=M("can");return m(),y(W,null,{default:_(()=>[a("div",q,[a("div",G,[a("div",H,[e[8]||(e[8]=a("h1",{class:"text-2xl font-bold text-gray-900 dark:text-gray-100"},"Enter Subject Exam Results",-1)),p(g,{variant:"outline",onClick:e[0]||(e[0]=s=>l.$inertia.visit(l.route("exam-results.index")))},{default:_(()=>e[7]||(e[7]=[h("Back")])),_:1,__:[7]})]),l.noExamExists?(m(),u("div",J,[e[10]||(e[10]=a("span",null," ⚠️ No exam has been created for this class yet. Please schedule an exam before entering results.",-1)),P((m(),y(g,{variant:"default",size:"sm",class:"px-4 py-2 text-sm",onClick:e[1]||(e[1]=s=>d(f).visit(l.route("exams.index")))},{default:_(()=>[p(d(E),{class:"w-4 h-4 mr-2"}),e[9]||(e[9]=h(" Add Exams "))]),_:1,__:[9]})),[[o,"create-exams"]])])):l.noExamPapers?(m(),u("div",K,[e[12]||(e[12]=a("span",null," ⚠️ The selected exam does not have any subjects added yet. Please add exam papers before entering results.",-1)),P((m(),y(g,{variant:"default",size:"sm",class:"px-4 py-2 text-sm",onClick:e[2]||(e[2]=s=>d(f).visit(l.route("exam-papers.index")))},{default:_(()=>[p(d(E),{class:"w-4 h-4 mr-2"}),e[11]||(e[11]=h(" Add Exam Paper "))]),_:1,__:[11]})),[[o,"create-exam-papers"]])])):C("",!0),a("form",{onSubmit:z(j,["prevent"]),class:"space-y-6"},[a("div",Q,[p(x,{id:"school_id",modelValue:d(t).school_id,"onUpdate:modelValue":e[3]||(e[3]=s=>d(t).school_id=s),label:"School",options:n.schools.map(s=>({label:s.name,value:String(s.id)})),placeholder:"Select School",error:v.value.school_id,onChange:I},null,8,["modelValue","options","error"]),p(x,{id:"class_id",modelValue:d(t).class_id,"onUpdate:modelValue":e[4]||(e[4]=s=>d(t).class_id=s),label:"Class",options:n.classes.map(s=>({label:s.name,value:String(s.id)})),placeholder:"Select Class",disabled:!d(t).school_id,error:v.value.class_id,onChange:F},null,8,["modelValue","options","disabled","error"]),p(x,{id:"exam_paper_id",modelValue:d(t).exam_paper_id,"onUpdate:modelValue":e[5]||(e[5]=s=>d(t).exam_paper_id=s),label:"Exam Paper",class:"col-span-2",options:n.examPapers.map(s=>({label:`${s.subject.name} - ${s.exam.title} `,value:String(s.id)})),placeholder:"Select Exam Paper",disabled:!d(t).class_id,error:v.value.exam_paper_id,onChange:R},null,8,["modelValue","options","disabled","error"])]),n.students.length?(m(),u("div",X,[a("table",Y,[e[13]||(e[13]=a("thead",null,[a("tr",{class:"bg-gray-100 dark:bg-neutral-800 text-left"},[a("th",{class:"p-2 text-sm"},"#"),a("th",{class:"p-2 text-sm"},"Student"),a("th",{class:"p-2 text-sm"},"Obtained Marks"),a("th",{class:"p-2 text-sm"},"Total Marks"),a("th",{class:"p-2 text-sm"},"Status"),a("th",{class:"p-2 text-sm"},"Promotion"),a("th",{class:"p-2 text-sm"},"Remarks"),a("th",{class:"p-2 text-sm"},"Paper Image(s)")])],-1)),a("tbody",null,[(m(!0),u(O,null,T(d(t).results,(s,r)=>{var c;return m(),u("tr",{key:r,class:"border-b dark:border-neutral-700"},[a("td",Z,k(r+1),1),a("td",ee,k(n.students[r].name)+" (Reg# "+k(n.students[r].registration_number)+") ",1),a("td",se,[p(S,{modelValue:s.obtained_marks,"onUpdate:modelValue":i=>s.obtained_marks=i,type:"number",min:"0",class:"w-24",error:b(r,"obtained_marks"),placeholder:"Marks"},null,8,["modelValue","onUpdate:modelValue","error"])]),a("td",te,[p(S,{modelValue:s.total_marks,"onUpdate:modelValue":i=>s.total_marks=i,type:"number",min:"0",class:"w-24",error:b(r,"total_marks"),placeholder:"100"},null,8,["modelValue","onUpdate:modelValue","error"])]),a("td",ae,[p(x,{modelValue:s.status,"onUpdate:modelValue":i=>s.status=i,options:[{label:"Pass",value:"pass"},{label:"Fail",value:"fail"},{label:"Absent",value:"absent"}],placeholder:"Select Status",error:b(r,"status")},null,8,["modelValue","onUpdate:modelValue","error"])]),a("td",le,[p(x,{modelValue:s.promotion_status,"onUpdate:modelValue":i=>s.promotion_status=i,options:[{label:"Pending",value:"pending"},{label:"Promoted",value:"promoted"},{label:"Failed",value:"failed"}],placeholder:"Promotion",error:b(r,"promotion_status")},null,8,["modelValue","onUpdate:modelValue","error"])]),a("td",oe,[p(S,{modelValue:s.remarks,"onUpdate:modelValue":i=>s.remarks=i,type:"text",class:"w-full",error:b(r,"remarks"),placeholder:"Remarks"},null,8,["modelValue","onUpdate:modelValue","error"])]),a("td",re,[a("input",{type:"file",multiple:"",accept:"image/*",onChange:i=>U(i,r),class:"block w-full text-sm file:mr-4 file:py-1 file:px-2 file:rounded file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100 dark:file:bg-neutral-800 dark:file:text-neutral-200 dark:hover:file:bg-neutral-700"},null,40,de),(c=d(t).results[r].images)!=null&&c.length?(m(),u("div",ne,k(d(t).results[r].images.length)+" image(s) selected ",1)):C("",!0)])])}),128))])])])):(m(),u("div",ie,e[14]||(e[14]=[a("p",{class:"text-yellow-700 dark:text-yellow-200 font-medium"},"⚠️ No Students Found",-1),a("p",{class:"text-yellow-600 dark:text-yellow-300 text-sm"},"Please select a class with admitted students.",-1)]))),a("div",me,[p(g,{type:"button",variant:"outline",onClick:e[6]||(e[6]=s=>l.$inertia.visit(l.route("exam-results.index")))},{default:_(()=>e[15]||(e[15]=[h(" Cancel ")])),_:1,__:[15]}),p(g,{type:"submit",disabled:d(t).processing||!n.students.length},{default:_(()=>[d(t).processing?(m(),u("span",pe,"Saving...")):n.students.length?(m(),u("span",ce,"Save Results")):(m(),u("span",ue,"No Students Available"))]),_:1},8,["disabled"])])],32)])])]),_:1})}}});export{$e as default};
