import{d as I,x as D,c as x,b as P,o as a,e as y,g as o,f as u,_,j as k,p as M,i as d,u as l,F as w,m as F,k as S,z as V,A as C,v as O,t as m,n as z,W as g,l as b}from"./app-0hD9jktS.js";import{_ as L}from"./AppLayout.vue_vue_type_script_setup_true_lang-C_OfVMdc.js";import{_ as h,a as R}from"./SelectInput-C8qFFp1m.js";import{T as W}from"./trash-hGn8IamB.js";import"./RovingFocusGroup-BrsbekXI.js";import"./AvatarImage.vue_vue_type_script_setup_true_lang-DLhJV-ve.js";import"./AppLogo.vue_vue_type_script_setup_true_lang-DV00-4L5.js";import"./building-2-0J7JWYjO.js";import"./users-CQiJNf1m.js";import"./school-SWVnhMs_.js";import"./chevron-down-Bc9-FnA7.js";import"./check-DytFQTDT.js";import"./Label.vue_vue_type_script_setup_true_lang-CLv8w6I-.js";import"./Input.vue_vue_type_script_setup_true_lang-ByoFr_iA.js";import"./InputError.vue_vue_type_script_setup_true_lang-BnFbo3YU.js";const K={class:"max-w-7xl mx-auto w-full px-4 py-8"},q={class:"bg-white dark:bg-neutral-900 rounded-lg shadow-md p-6"},G={class:"flex items-center justify-between mb-6"},H={class:"grid grid-cols-1 md:grid-cols-4 gap-4"},J={class:"bg-gray-50 dark:bg-neutral-800 shadow rounded-lg p-4"},Q={class:"w-full md:w-1/2"},X=["onUpdate:modelValue"],Y={key:0,class:"text-red-500 text-sm mt-1"},Z={class:"w-full md:w-1/2"},ee=["onUpdate:modelValue"],te={key:0,class:"text-red-500 text-sm mt-1"},oe={class:"w-full md:w-auto flex items-center justify-end md:justify-start"},se=["onClick","disabled"],re={key:0,class:"bg-blue-100 dark:bg-blue-800 rounded-lg p-4"},le={class:"max-h-40 overflow-y-auto"},ae={class:"grid grid-cols-3 sm:grid-cols-1 gap-2"},de={key:1,class:"text-center py-4 px-4 bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg"},ie={class:"flex justify-end space-x-3"},ne={key:0},ue={key:1},pe={key:2},Ce=I({__name:"Edit",props:{fee:{},schools:{},classes:{},students:{}},setup(T){const r=T,U={admission:"Admission Fee",monthly:"Monthly Fee",papers:"Papers Fee"},s=D({type:r.fee.type,due_date:r.fee.due_date,school_id:String(r.fee.school_id),class_id:String(r.fee.class_id),fee_items:r.fee.fee_items.map(i=>({type:i.type,amount:String(i.amount)}))}),c=x(()=>s.errors),N=x(()=>new Date().toISOString().split("T")[0]);function v(){g.visit(route("fees.index"))}function p(i,t){const e=`fee_items.${i}.${t}`;return s.errors[e]}function j(){s.class_id="",s.school_id&&g.get(route("fees.edit",r.fee.id),{school_id:s.school_id},{preserveState:!0,preserveScroll:!0,replace:!0})}function E(){s.school_id&&s.class_id&&g.get(route("fees.edit",r.fee.id),{school_id:s.school_id,class_id:s.class_id},{preserveState:!0,preserveScroll:!0,replace:!0})}function $(){s.fee_items.push({type:"",amount:""})}function A(i){s.fee_items.splice(i,1)}function B(){let i=!0;s.fee_items.forEach(t=>{(!t.type||!t.amount||Number(t.amount)<=0)&&(i=!1,b.error("Please fill in all fee item types and positive amounts."))}),i&&s.put(route("fees.update",r.fee.id),{onSuccess:()=>b.success("Fee updated successfully!"),onError:t=>{Object.values(t).flat().forEach(e=>{typeof e=="string"&&b.error(e)})}})}return(i,t)=>(a(),P(L,null,{default:y(()=>[o("div",K,[o("div",q,[o("div",G,[t[5]||(t[5]=o("h1",{class:"text-2xl font-bold text-gray-900 dark:text-gray-100"},"Edit Fee",-1)),u(_,{variant:"outline",onClick:v},{default:y(()=>t[4]||(t[4]=[k("Back to Fees")])),_:1,__:[4]})]),o("form",{onSubmit:M(B,["prevent"]),class:"space-y-6"},[o("div",H,[u(h,{id:"school_id",modelValue:l(s).school_id,"onUpdate:modelValue":t[0]||(t[0]=e=>l(s).school_id=e),label:"School",disabled:"",options:r.schools.map(e=>({label:e.name,value:String(e.id)})),placeholder:"Select School",error:c.value.school_id,onChange:j},null,8,["modelValue","options","error"]),u(h,{id:"fee_type",modelValue:l(s).type,"onUpdate:modelValue":t[1]||(t[1]=e=>l(s).type=e),label:"Fee Type",options:Object.entries(U).map(([e,n])=>({label:n,value:e})),placeholder:"Select Fee Type",error:c.value.type},null,8,["modelValue","options","error"]),u(h,{id:"class_id",modelValue:l(s).class_id,"onUpdate:modelValue":t[2]||(t[2]=e=>l(s).class_id=e),label:"Class",options:r.classes.map(e=>({label:e.name,value:String(e.id)})),disabled:"",placeholder:"Select Class",error:c.value.class_id,onChange:E},null,8,["modelValue","options","error"]),u(R,{id:"due_date",modelValue:l(s).due_date,"onUpdate:modelValue":t[3]||(t[3]=e=>l(s).due_date=e),label:"Due Date",type:"date",min:N.value,error:c.value.due_date},null,8,["modelValue","min","error"])]),o("div",J,[t[7]||(t[7]=o("label",{class:"block mb-4 text-gray-700 dark:text-gray-200 font-medium"},"Fee Items",-1)),(a(!0),d(w,null,F(l(s).fee_items,(e,n)=>(a(),d("div",{key:n,class:"flex flex-col md:flex-row md:items-center gap-4 mb-4"},[o("div",Q,[S(o("select",{"onUpdate:modelValue":f=>e.type=f,class:C(["w-full px-3 py-2 rounded-md border","bg-white dark:bg-neutral-900","text-gray-900 dark:text-gray-100","border-gray-300 dark:border-gray-600","focus:outline-none focus:ring-1 focus:ring-primary-500 focus:border-primary-500",p(n,"type")?"border-red-500":""])},t[6]||(t[6]=[o("option",{value:"",disabled:""},"Select Fee Type",-1),o("option",{value:"tuition"},"Tuition Fee",-1),o("option",{value:"library"},"Library Fee",-1),o("option",{value:"security"},"Security Fee",-1),o("option",{value:"papers"},"Papers Fee",-1),o("option",{value:"sports"},"Sports Fee",-1),o("option",{value:"transport"},"Transport Fee",-1),o("option",{value:"admission"},"Admission Fee",-1)]),10,X),[[O,e.type]]),p(n,"type")?(a(),d("p",Y,m(p(n,"type")),1)):V("",!0)]),o("div",Z,[S(o("input",{"onUpdate:modelValue":f=>e.amount=f,type:"number",min:"0",step:"0.01",placeholder:"Amount (PKR)",class:C(["w-full px-3 py-2 rounded-md border","bg-white dark:bg-neutral-900","text-gray-900 dark:text-gray-100","border-gray-300 dark:border-gray-600","focus:outline-none focus:ring-1 focus:ring-primary-500 focus:border-primary-500",p(n,"amount")?"border-red-500":""])},null,10,ee),[[z,e.amount]]),p(n,"amount")?(a(),d("p",te,m(p(n,"amount")),1)):V("",!0)]),o("div",oe,[o("button",{type:"button",onClick:f=>A(n),disabled:l(s).fee_items.length===1,class:"px-4 py-2 text-sm font-medium text-white bg-red-600 hover:bg-red-700 rounded-md disabled:opacity-50"},[u(l(W),{class:"w-5 h-5 text-white cursor-pointer"})],8,se)])]))),128)),o("button",{type:"button",onClick:$,class:"px-4 py-2 text-sm font-medium text-primary-700 border border-primary-600 hover:bg-primary-100 rounded-md mt-2"}," + Add Fee Item ")]),r.students.length?(a(),d("div",re,[o("div",le,[o("div",ae,[(a(!0),d(w,null,F(r.students,e=>(a(),d("div",{key:e.id,class:"text-sm text-gray-600 dark:text-gray-300"},m(e.id)+" : "+m(e.name)+" (Reg# "+m(e.registration_number)+") ",1))),128))])])])):(a(),d("div",de,t[8]||(t[8]=[o("div",{class:"text-yellow-800 dark:text-yellow-200 font-medium mb-1"},"⚠️ No Students Found",-1),o("div",{class:"text-yellow-700 dark:text-yellow-300 text-sm"}," No admitted students found in the selected class. Please ensure there are admitted students before assigning fees. ",-1)]))),o("div",ie,[u(_,{type:"button",variant:"outline",onClick:v},{default:y(()=>t[9]||(t[9]=[k("Cancel")])),_:1,__:[9]}),u(_,{type:"submit",disabled:l(s).processing||!r.students.length},{default:y(()=>[l(s).processing?(a(),d("span",ne,"Updating...")):r.students.length?(a(),d("span",pe,"Update Fee")):(a(),d("span",ue,"No Students Available"))]),_:1},8,["disabled"])])],32)])])]),_:1}))}});export{Ce as default};
