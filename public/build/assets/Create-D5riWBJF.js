import{d as A,x as D,c as x,b as O,o as l,e as f,g as o,f as n,_ as g,j as k,p as P,i as d,u as r,F as w,m as S,k as C,z as F,A as V,v as M,t as p,n as z,W as b,l as _}from"./app-0hD9jktS.js";import{_ as L}from"./AppLayout.vue_vue_type_script_setup_true_lang-C_OfVMdc.js";import{_ as h,a as R}from"./SelectInput-C8qFFp1m.js";import{T as W}from"./trash-hGn8IamB.js";import"./RovingFocusGroup-BrsbekXI.js";import"./AvatarImage.vue_vue_type_script_setup_true_lang-DLhJV-ve.js";import"./AppLogo.vue_vue_type_script_setup_true_lang-DV00-4L5.js";import"./building-2-0J7JWYjO.js";import"./users-CQiJNf1m.js";import"./school-SWVnhMs_.js";import"./chevron-down-Bc9-FnA7.js";import"./check-DytFQTDT.js";import"./Label.vue_vue_type_script_setup_true_lang-CLv8w6I-.js";import"./Input.vue_vue_type_script_setup_true_lang-ByoFr_iA.js";import"./InputError.vue_vue_type_script_setup_true_lang-BnFbo3YU.js";const K={class:"max-w-7xl mx-auto w-full px-4 py-8"},q={class:"bg-white dark:bg-neutral-900 rounded-lg shadow-md p-6"},G={class:"flex items-center justify-between mb-6"},H={class:"grid grid-cols-1 md:grid-cols-4 gap-4"},J={class:"bg-gray-50 dark:bg-neutral-800 shadow rounded-lg p-4"},Q={class:"w-full md:w-1/2"},X=["onUpdate:modelValue"],Y={key:0,class:"text-red-500 text-sm mt-1"},Z={class:"w-full md:w-1/2"},ee=["onUpdate:modelValue"],te={key:0,class:"text-red-500 text-sm mt-1"},oe={class:"w-full md:w-auto flex items-center justify-end md:justify-start"},se=["onClick","disabled"],re={key:0,class:"bg-blue-100 dark:bg-blue-800 rounded-lg p-4"},le={class:"text-lg font-medium text-gray-900 dark:text-gray-100 mb-3"},ae={class:"max-h-40 overflow-y-auto"},de={class:"grid grid-cols-3 sm:grid-cols-1 gap-2"},ie={key:1,class:"text-center py-4 px-4 bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg"},ne={class:"flex justify-end space-x-3"},ue={key:0},ce={key:1},pe={key:2},Ie=A({__name:"Create",props:{schools:{},classes:{},students:{},selectedSchoolId:{},selectedClassId:{}},setup(I){const T={admission:"Admission Fee",monthly:"Monthly Fee",papers:"Papers Fee"},a=I,s=D({fee_items:[{type:"",amount:""}],type:"",due_date:"",school_id:a.selectedSchoolId?String(a.selectedSchoolId):"",class_id:a.selectedClassId?String(a.selectedClassId):""}),m=x(()=>s.errors),j=x(()=>new Date().toISOString().split("T")[0]);function v(){b.visit(route("fees.index"))}function c(u,t){const e=`fee_items.${u}.${t}`;return s.errors[e]}function N(){s.class_id="",s.school_id&&b.get(route("fees.create"),{school_id:s.school_id},{preserveState:!0,preserveScroll:!0,replace:!0})}function U(){s.school_id&&s.class_id&&b.get(route("fees.create"),{school_id:s.school_id,class_id:s.class_id},{preserveState:!0,preserveScroll:!0,replace:!0})}function $(){s.fee_items.push({type:"",amount:""})}function B(u){s.fee_items.splice(u,1)}function E(){let u=!0;s.fee_items.forEach(t=>{(!t.type||!t.amount||Number(t.amount)<=0)&&(u=!1,_.error("Please fill in all fee item types and positive amounts."))}),u&&s.post(route("fees.store"),{onSuccess:t=>{t.props.errors&&Object.keys(t.props.errors).length>0?Object.values(t.props.errors).flat().forEach(e=>{typeof e=="string"&&_.error(e)}):_.success("Fee created successfully!")},onError:t=>{Object.values(t).flat().forEach(e=>{typeof e=="string"&&_.error(e)})}})}return(u,t)=>(l(),O(L,null,{default:f(()=>[o("div",K,[o("div",q,[o("div",G,[t[5]||(t[5]=o("h1",{class:"text-2xl font-bold text-gray-900 dark:text-gray-100"},"Create New Fee",-1)),n(g,{variant:"outline",onClick:v},{default:f(()=>t[4]||(t[4]=[k("Back to Fees")])),_:1,__:[4]})]),o("form",{onSubmit:P(E,["prevent"]),class:"space-y-6"},[o("div",H,[n(h,{id:"school_id",modelValue:r(s).school_id,"onUpdate:modelValue":t[0]||(t[0]=e=>r(s).school_id=e),label:"School",options:a.schools.map(e=>({label:e.name,value:String(e.id)})),placeholder:"Select School",error:m.value.school_id,onChange:N},null,8,["modelValue","options","error"]),n(h,{id:"fee_type",modelValue:r(s).type,"onUpdate:modelValue":t[1]||(t[1]=e=>r(s).type=e),label:"Fee Type",options:Object.entries(T).map(([e,i])=>({label:i,value:e})),placeholder:"Select Fee Type",error:m.value.type},null,8,["modelValue","options","error"]),n(h,{id:"class_id",modelValue:r(s).class_id,"onUpdate:modelValue":t[2]||(t[2]=e=>r(s).class_id=e),label:"Class",options:a.classes.map(e=>({label:e.name,value:String(e.id)})),placeholder:"Select Class",error:m.value.class_id,disabled:!r(s).school_id,onChange:U},null,8,["modelValue","options","error","disabled"]),n(R,{id:"due_date",modelValue:r(s).due_date,"onUpdate:modelValue":t[3]||(t[3]=e=>r(s).due_date=e),label:"Due Date",type:"date",min:j.value,error:m.value.due_date},null,8,["modelValue","min","error"])]),o("div",J,[t[7]||(t[7]=o("label",{class:"block mb-4 text-gray-700 dark:text-gray-200 font-medium"},"Fee Items",-1)),(l(!0),d(w,null,S(r(s).fee_items,(e,i)=>(l(),d("div",{key:i,class:"flex flex-col md:flex-row md:items-center gap-4 mb-4"},[o("div",Q,[C(o("select",{"onUpdate:modelValue":y=>e.type=y,class:V(["w-full px-3 py-2 rounded-md border","bg-white dark:bg-neutral-900","text-gray-900 dark:text-gray-100","border-gray-300 dark:border-gray-600","focus:outline-none focus:ring-1 focus:ring-primary-500 focus:border-primary-500",c(i,"type")?"border-red-500":""])},t[6]||(t[6]=[o("option",{value:"",disabled:""},"Select Fee Type",-1),o("option",{value:"tuition"},"Tuition Fee",-1),o("option",{value:"library"},"Library Fee",-1),o("option",{value:"security"},"Security Fee",-1),o("option",{value:"papers"},"Papers Fee",-1),o("option",{value:"sports"},"Sports Fee",-1),o("option",{value:"transport"},"Transport Fee",-1)]),10,X),[[M,e.type]]),c(i,"type")?(l(),d("p",Y,p(c(i,"type")),1)):F("",!0)]),o("div",Z,[C(o("input",{"onUpdate:modelValue":y=>e.amount=y,type:"number",min:"0",step:"0.01",placeholder:"Amount (PKR)",class:V(["w-full px-3 py-2 rounded-md border","bg-white dark:bg-neutral-900","text-gray-900 dark:text-gray-100","border-gray-300 dark:border-gray-600","focus:outline-none focus:ring-1 focus:ring-primary-500 focus:border-primary-500",c(i,"amount")?"border-red-500":""])},null,10,ee),[[z,e.amount]]),c(i,"amount")?(l(),d("p",te,p(c(i,"amount")),1)):F("",!0)]),o("div",oe,[o("button",{type:"button",onClick:y=>B(i),disabled:r(s).fee_items.length===1,class:"px-4 py-2 text-sm font-medium text-white bg-red-600 hover:bg-red-700 rounded-md disabled:opacity-50"},[n(r(W),{type:"button",class:"w-5 h-5 text-white cursor-pointer"})],8,se)])]))),128)),o("button",{type:"button",onClick:$,class:"px-4 py-2 text-sm font-medium text-primary-700 border border-primary-600 hover:bg-primary-100 rounded-md mt-2"}," + Add Fee Item ")]),a.students.length?(l(),d("div",re,[o("h3",le," Total Students in Selected Class ("+p(a.students.length)+") ",1),o("div",ae,[o("div",de,[(l(!0),d(w,null,S(a.students,e=>(l(),d("div",{key:e.id,class:"text-sm text-gray-600 dark:text-gray-300"},p(e.id)+" : "+p(e.name)+" (Reg# "+p(e.registration_number)+") ",1))),128))])])])):(l(),d("div",ie,t[8]||(t[8]=[o("div",{class:"text-yellow-800 dark:text-yellow-200 font-medium mb-1"},"⚠️ No Students Found",-1),o("div",{class:"text-yellow-700 dark:text-yellow-300 text-sm"}," No admitted students found in the selected class. Please ensure there are admitted students before creating fees. ",-1)]))),o("div",ne,[n(g,{type:"button",variant:"outline",onClick:v},{default:f(()=>t[9]||(t[9]=[k("Cancel")])),_:1,__:[9]}),n(g,{type:"submit",disabled:r(s).processing||!a.students.length},{default:f(()=>[r(s).processing?(l(),d("span",ue,"Creating...")):a.students.length?(l(),d("span",pe,"Create Fee")):(l(),d("span",ce,"No Students Available"))]),_:1},8,["disabled"])])],32)])])]),_:1}))}});export{Ie as default};
