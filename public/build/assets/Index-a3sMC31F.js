import{r as p,a as Q,l as C,d as X,w as j,c as Y,b as B,o as r,e as x,f as d,g as t,u as l,h as Z,i as o,j as f,k as b,F as y,m as v,t as n,v as h,n as I,_ as T,W as ee,x as te}from"./app-0hD9jktS.js";import{F as se,l as ae}from"./style-BhhzWR2R.js";import{_ as re}from"./AppLayout.vue_vue_type_script_setup_true_lang-C_OfVMdc.js";import{_ as F}from"./Label.vue_vue_type_script_setup_true_lang-CLv8w6I-.js";import{C as L}from"./calendar-DjniW4jB.js";import{B as le}from"./building-2-0J7JWYjO.js";import{U as M}from"./users-CQiJNf1m.js";import{R}from"./refresh-cw-DBp2ONfo.js";import{L as oe}from"./loader-circle-Dg-d1WoA.js";import{S as de}from"./save-DvCxJJrq.js";import"./RovingFocusGroup-BrsbekXI.js";import"./AvatarImage.vue_vue_type_script_setup_true_lang-DLhJV-ve.js";import"./AppLogo.vue_vue_type_script_setup_true_lang-DV00-4L5.js";import"./school-SWVnhMs_.js";import"./chevron-down-Bc9-FnA7.js";import"./check-DytFQTDT.js";function ne(){const U=p([]),c=p(!1);async function V(A){if(U.value=[],!!A){c.value=!0;try{const N=await Q.get(`/api/classes/${A}/sections`);U.value=N.data}catch{C.error("Failed to fetch sections")}finally{c.value=!1}}}return{sections:U,loading:c,fetchSectionsByClass:V}}const ie={class:"max-w-7xl mx-auto w-full px-4 py-6 sm:py-8"},ue={class:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-6"},ce={class:"text-2xl sm:text-3xl font-bold text-neutral-900 dark:text-neutral-100 flex items-center gap-3"},me={class:"bg-white dark:bg-neutral-900 rounded-xl border border-gray-200 dark:border-neutral-700 p-6 mb-6"},fe={class:"hidden md:grid grid-cols-1 md:grid-cols-5 gap-4"},ge=["value"],xe=["value"],be=["value"],pe={class:"flex items-end"},ye={class:"md:hidden"},ve={key:0,class:"bg-white dark:bg-neutral-900 rounded-xl border border-gray-200 dark:border-neutral-700 overflow-hidden"},ke={class:"p-6 border-b border-gray-200 dark:border-neutral-700"},_e={class:"text-lg font-semibold text-gray-900 dark:text-gray-100 mb-2"},he={class:"text-sm text-gray-600 dark:text-gray-400"},we={class:"overflow-x-auto"},Se={class:"w-full"},Ce={class:"bg-white dark:bg-neutral-900 divide-y divide-gray-200 dark:divide-neutral-700"},Ue={class:"px-6 py-4 whitespace-nowrap"},Ve={class:"flex items-center"},De={class:"flex-shrink-0 h-10 w-10"},Ae={class:"h-10 w-10 rounded-full bg-blue-100 dark:bg-blue-900/30 flex items-center justify-center"},Ne=["src"],Te={key:1,class:"text-sm font-medium text-blue-600 dark:text-blue-400"},Fe={class:"ml-4"},je={class:"text-sm font-medium text-gray-900 dark:text-gray-100"},Be={class:"text-sm text-gray-500 dark:text-gray-400"},Ie={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900 dark:text-gray-100"},Le={class:"px-6 py-4 whitespace-nowrap"},Me=["onUpdate:modelValue"],Pe=["value"],Ee={class:"px-6 py-4 whitespace-nowrap"},Re=["onUpdate:modelValue"],$e={class:"p-6 border-t border-gray-200 dark:border-neutral-700"},Oe={key:1,class:"text-center py-12"},We={class:"w-16 h-16 mx-auto mb-4 bg-gray-100 dark:bg-gray-800 rounded-full flex items-center justify-center"},ze={key:2,class:"text-center py-12"},qe={class:"w-16 h-16 mx-auto mb-4 bg-gray-100 dark:bg-gray-800 rounded-full flex items-center justify-center"},Ge={class:"sheet-content dark:bg-neutral-900"},He={class:"flex flex-col gap-4"},Je={class:"flex flex-col"},Ke=["value"],Qe={class:"flex flex-col"},Xe=["value"],Ye={class:"flex flex-col"},Ze=["value"],et={class:"flex flex-col"},tt={class:"pt-2"},yt=X({__name:"Index",props:{classes:{},sections:{},teachers:{},students:{},attendances:{},selectedClass:{},selectedSection:{},selectedTeacher:{},selectedDate:{},statuses:{}},setup(U){const c=U,V=p();function A(){var a;(a=V.value)==null||a.open()}function N(){var a;(a=V.value)==null||a.close()}const $=[{title:"Dashboard",href:"/"},{title:"Attendance",href:"/attendance"}],i=p(c.selectedClass||""),k=p(c.selectedSection||""),w=p(c.selectedTeacher||""),m=p(c.selectedDate),_=p(c.students||[]),S=p(!1),{sections:O,fetchSectionsByClass:W}=ne();j(i,a=>{k.value="",W(a)});const g=p({});j(()=>c.students,a=>{_.value=a||[],z()},{immediate:!0}),j(()=>c.attendances,a=>{a&&Object.entries(a).forEach(([e,s])=>{const u=parseInt(e);g.value[u]&&(g.value[u].status=s.status,g.value[u].remarks=s.remarks||"")})},{immediate:!0});function z(){g.value={},_.value.forEach(a=>{g.value[a.id]={status:"present",remarks:""}})}const q=Y(()=>{const a=c.classes.find(e=>e.id.toString()===i.value.toString());return a?a.name:""});function G(a){return new Date(a).toLocaleDateString("en-US",{weekday:"long",year:"numeric",month:"long",day:"numeric"})}function H(a){return a.split(" ").map(e=>e.charAt(0)).join("").toUpperCase().substring(0,2)}function P(){if(!i.value||!m.value){C.error("Please select both class and date");return}ee.visit(route("attendance.index"),{data:{class_id:i.value,section_id:k.value,teacher_id:w.value,date:m.value},preserveState:!0,preserveScroll:!0,replace:!0})}function J(){P(),N()}function K(){if(!i.value||!m.value){C.error("Please select both class and date");return}if(_.value.length===0){C.error("No students to mark attendance for");return}S.value=!0,te({class_id:i.value,section_id:k.value,teacher_id:w.value,date:m.value,attendance_data:Object.entries(g.value).map(([e,s])=>({student_id:parseInt(e),status:s.status,remarks:s.remarks}))}).post(route("attendance.store"),{onSuccess:()=>{C.success("Attendance marked successfully!"),S.value=!1},onError:e=>{C.error("Failed to mark attendance. Please try again."),S.value=!1}})}return(a,e)=>(r(),B(re,{breadcrumbs:$},{default:x(()=>[d(l(Z),{title:"Attendance Management"}),t("div",ie,[t("div",ue,[t("div",null,[t("h1",ce,[d(l(L),{class:"w-8 h-8 text-blue-600"}),e[8]||(e[8]=f(" Attendance Management "))]),e[9]||(e[9]=t("p",{class:"text-sm text-gray-600 dark:text-gray-400 mt-2"}," Mark and manage student attendance ",-1))])]),t("div",me,[t("div",fe,[t("div",null,[d(l(F),{for:"class_id",class:"block mb-2 text-sm font-medium text-gray-700 dark:text-gray-300"},{default:x(()=>[d(l(le),{class:"w-4 h-4 inline mr-2"}),e[10]||(e[10]=f(" Class ")),e[11]||(e[11]=t("span",{class:"text-red-500"},"*",-1))]),_:1,__:[10,11]}),b(t("select",{id:"class_id","onUpdate:modelValue":e[0]||(e[0]=s=>i.value=s),class:"w-full px-2 py-1 text-sm border border-gray-300 dark:border-neutral-600 rounded bg-white dark:bg-neutral-700 text-gray-900 dark:text-gray-100 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all"},[e[12]||(e[12]=t("option",{value:""},"Select Class",-1)),(r(!0),o(y,null,v(a.classes,s=>(r(),o("option",{key:s.id,value:s.id},n(s.name),9,ge))),128))],512),[[h,i.value]])]),t("div",null,[d(l(F),{for:"section_id",class:"block mb-2 text-sm font-medium text-gray-700 dark:text-gray-300"},{default:x(()=>[d(l(M),{class:"w-4 h-4 inline mr-2"}),e[13]||(e[13]=f(" Section "))]),_:1,__:[13]}),b(t("select",{id:"section_id","onUpdate:modelValue":e[1]||(e[1]=s=>k.value=s),class:"w-full px-2 py-1 text-sm border border-gray-300 dark:border-neutral-600 rounded bg-white dark:bg-neutral-700 text-gray-900 dark:text-gray-100 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all"},[e[14]||(e[14]=t("option",{value:""},"All Sections",-1)),(r(!0),o(y,null,v(l(O),s=>(r(),o("option",{key:s.id,value:s.id},n(s.name),9,xe))),128))],512),[[h,k.value]])]),t("div",null,[d(l(F),{for:"teacher_id",class:"block mb-2 text-sm font-medium text-gray-700 dark:text-gray-300"},{default:x(()=>[d(l(M),{class:"w-4 h-4 inline mr-2"}),e[15]||(e[15]=f(" Teacher "))]),_:1,__:[15]}),b(t("select",{id:"teacher_id","onUpdate:modelValue":e[2]||(e[2]=s=>w.value=s),class:"w-full px-2 py-1 text-sm border border-gray-300 dark:border-neutral-600 rounded bg-white dark:bg-neutral-700 text-gray-900 dark:text-gray-100 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all"},[e[16]||(e[16]=t("option",{value:""},"Select Teacher",-1)),(r(!0),o(y,null,v(a.teachers,s=>{var u;return r(),o("option",{key:s.id,value:s.id},n(((u=s.user)==null?void 0:u.name)||"Unknown Teacher"),9,be)}),128))],512),[[h,w.value]])]),t("div",null,[d(l(F),{for:"date",class:"block mb-2 text-sm font-medium text-gray-700 dark:text-gray-300"},{default:x(()=>[d(l(L),{class:"w-4 h-4 inline mr-2"}),e[17]||(e[17]=f(" Date ")),e[18]||(e[18]=t("span",{class:"text-red-500"},"*",-1))]),_:1,__:[17,18]}),b(t("input",{type:"date",id:"date","onUpdate:modelValue":e[3]||(e[3]=s=>m.value=s),class:"w-full px-2 py-1 text-sm border border-gray-300 dark:border-neutral-600 rounded bg-white dark:bg-neutral-700 text-gray-900 dark:text-gray-100 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all"},null,512),[[I,m.value]])]),t("div",pe,[d(l(T),{onClick:P,disabled:!i.value||!m.value,class:"w-full px-3 py-2 text-sm"},{default:x(()=>[d(l(R),{class:"w-4 h-4 mr-2"}),e[19]||(e[19]=f(" Load Students "))]),_:1,__:[19]},8,["disabled"])])]),t("div",ye,[d(l(T),{onClick:A,variant:"outline",class:"w-full px-3 py-2 text-sm"},{default:x(()=>[d(l(se),{class:"w-4 h-4 mr-2"}),e[20]||(e[20]=f(" Filters "))]),_:1,__:[20]})])]),_.value.length>0?(r(),o("div",ve,[t("div",ke,[t("h2",_e," Mark Attendance for "+n(q.value)+" - "+n(G(m.value)),1),t("p",he,n(_.value.length)+" student"+n(_.value.length!==1?"s":"")+" found ",1)]),t("div",we,[t("table",Se,[e[21]||(e[21]=t("thead",{class:"bg-gray-50 dark:bg-neutral-800"},[t("tr",null,[t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider"}," Student "),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider"}," Roll No "),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider"}," Status "),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-400 uppercase tracking-wider"}," Remarks ")])],-1)),t("tbody",Ce,[(r(!0),o(y,null,v(_.value,s=>{var u;return r(),o("tr",{key:s.id,class:"hover:bg-gray-50 dark:hover:bg-neutral-800"},[t("td",Ue,[t("div",Ve,[t("div",De,[t("div",Ae,[s.profile_photo_url?(r(),o("img",{key:0,src:s.profile_photo_url,alt:"Profile Photo",class:"h-10 w-10 rounded-full object-cover"},null,8,Ne)):(r(),o("span",Te,n(H(s.name||"Student")),1))])]),t("div",Fe,[t("div",je,n(s.name||"Unknown"),1),t("div",Be,n(((u=s.section)==null?void 0:u.name)||"No Section"),1)])])]),t("td",Ie,n(s.registration_number||"-"),1),t("td",Le,[b(t("select",{"onUpdate:modelValue":D=>g.value[s.id].status=D,class:"px-2 py-1 text-sm border border-gray-300 dark:border-neutral-600 rounded bg-white dark:bg-neutral-700 text-gray-900 dark:text-gray-100 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all"},[(r(!0),o(y,null,v(a.statuses,(D,E)=>(r(),o("option",{key:E,value:E},n(D),9,Pe))),128))],8,Me),[[h,g.value[s.id].status]])]),t("td",Ee,[b(t("input",{type:"text","onUpdate:modelValue":D=>g.value[s.id].remarks=D,placeholder:"Optional remarks",class:"w-full px-2 py-1 text-sm border border-gray-300 dark:border-neutral-600 rounded bg-white dark:bg-neutral-700 text-gray-900 dark:text-gray-100 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all"},null,8,Re),[[I,g.value[s.id].remarks]])])])}),128))])])]),t("div",$e,[d(l(T),{onClick:K,disabled:S.value,class:"w-full sm:w-auto px-4 py-2 text-sm"},{default:x(()=>[S.value?(r(),B(l(oe),{key:0,class:"w-4 h-4 mr-2 animate-spin"})):(r(),B(l(de),{key:1,class:"w-4 h-4 mr-2"})),f(" "+n(S.value?"Saving...":"Save Attendance"),1)]),_:1},8,["disabled"])])])):i.value&&m.value?(r(),o("div",Oe,[t("div",We,[d(l(M),{class:"w-8 h-8 text-gray-400"})]),e[22]||(e[22]=t("h3",{class:"text-lg font-medium text-gray-900 dark:text-gray-100 mb-2"},"No students found",-1)),e[23]||(e[23]=t("p",{class:"text-gray-600 dark:text-gray-400"}," No students are enrolled in the selected class and section. ",-1))])):(r(),o("div",ze,[t("div",qe,[d(l(L),{class:"w-8 h-8 text-gray-400"})]),e[24]||(e[24]=t("h3",{class:"text-lg font-medium text-gray-900 dark:text-gray-100 mb-2"},"Select Class and Date",-1)),e[25]||(e[25]=t("p",{class:"text-gray-600 dark:text-gray-400"}," Choose a class and date to start marking attendance. ",-1))]))]),d(l(ae),{overlay:!0,"can-swipe":!0,"overlay-click-close":!0,"transition-duration":.5,ref_key:"filterSheet",ref:V,class:"dark:bg-neutral-900"},{default:x(()=>[t("div",Ge,[e[34]||(e[34]=t("h2",{class:"text-lg font-semibold mb-4"},"Attendance Filters",-1)),t("div",He,[t("div",Je,[e[27]||(e[27]=t("label",{for:"class_id_mobile",class:"block text-sm font-medium text-gray-700 dark:text-gray-200 mb-1"},[f(" Class "),t("span",{class:"text-red-500"},"*")],-1)),b(t("select",{id:"class_id_mobile","onUpdate:modelValue":e[4]||(e[4]=s=>i.value=s),class:"w-full px-2 py-1 text-sm border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-neutral-900"},[e[26]||(e[26]=t("option",{value:""},"Select Class",-1)),(r(!0),o(y,null,v(a.classes,s=>(r(),o("option",{key:s.id,value:s.id},n(s.name),9,Ke))),128))],512),[[h,i.value]])]),t("div",Qe,[e[29]||(e[29]=t("label",{for:"section_id_mobile",class:"block text-sm font-medium text-gray-700 dark:text-gray-200 mb-1"}," Section ",-1)),b(t("select",{id:"section_id_mobile","onUpdate:modelValue":e[5]||(e[5]=s=>k.value=s),class:"w-full px-2 py-1 text-sm border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-neutral-900"},[e[28]||(e[28]=t("option",{value:""},"All Sections",-1)),(r(!0),o(y,null,v(a.sections,s=>(r(),o("option",{key:s.id,value:s.id},n(s.name),9,Xe))),128))],512),[[h,k.value]])]),t("div",Ye,[e[31]||(e[31]=t("label",{for:"teacher_id_mobile",class:"block text-sm font-medium text-gray-700 dark:text-gray-200 mb-1"}," Teacher ",-1)),b(t("select",{id:"teacher_id_mobile","onUpdate:modelValue":e[6]||(e[6]=s=>w.value=s),class:"w-full px-2 py-1 text-sm border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-neutral-900"},[e[30]||(e[30]=t("option",{value:""},"Select Teacher",-1)),(r(!0),o(y,null,v(a.teachers,s=>{var u;return r(),o("option",{key:s.id,value:s.id},n(((u=s.user)==null?void 0:u.name)||"Unknown Teacher"),9,Ze)}),128))],512),[[h,w.value]])]),t("div",et,[e[32]||(e[32]=t("label",{for:"date_mobile",class:"block text-sm font-medium text-gray-700 dark:text-gray-200 mb-1"},[f(" Date "),t("span",{class:"text-red-500"},"*")],-1)),b(t("input",{type:"date",id:"date_mobile","onUpdate:modelValue":e[7]||(e[7]=s=>m.value=s),class:"w-full px-2 py-1 text-sm border border-gray-300 dark:border-gray-600 rounded bg-white dark:bg-neutral-900"},null,512),[[I,m.value]])]),t("div",tt,[d(l(T),{onClick:J,disabled:!i.value||!m.value,class:"w-full px-3 py-2 text-sm"},{default:x(()=>[d(l(R),{class:"w-4 h-4 mr-2"}),e[33]||(e[33]=f(" Load Students "))]),_:1,__:[33]},8,["disabled"])])])])]),_:1},512)]),_:1}))}});export{yt as default};
