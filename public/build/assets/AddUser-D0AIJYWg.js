import{d as H,r as m,c as S,L as O,x as W,b as N,o as l,e as j,f as E,u as s,h as J,g as e,i as a,z as d,t as n,p as K,k as b,j as c,n as _,P as Q,F as R,m as B,v as X,l as g}from"./app-oDzFbDpS.js";import{_ as Y}from"./AppLayout.vue_vue_type_script_setup_true_lang-B8xcv65_.js";import{_ as Z}from"./Layout.vue_vue_type_script_setup_true_lang-C23prlkt.js";import{u as ee}from"./school-T4gwIvXC.js";import{_ as te}from"./Icon.vue_vue_type_script_setup_true_lang-CktM08l_.js";import{E as re}from"./eye-DjBiqAnr.js";import{E as se}from"./eye-off-ByIEJSqi.js";import"./RovingFocusGroup-CLnOwjDo.js";import"./AvatarImage.vue_vue_type_script_setup_true_lang-DPNLz3sn.js";import"./AppLogo.vue_vue_type_script_setup_true_lang-Cob2K5o9.js";import"./building-2-Dp0U14zc.js";import"./users-DDnJbTSp.js";import"./chevron-down-SN-issHr.js";import"./check-CEIiCWnz.js";import"./loader-circle-Dd3mNCCo.js";import"./target-BvkpxWi2.js";import"./triangle-alert-DX_7JuLF.js";import"./refresh-cw-CWAu1Of8.js";import"./save-BhC_gGhx.js";import"./plus-DaPcSaFA.js";import"./arrow-right-Dpm9A9Fy.js";import"./arrow-left-DCJF3lDn.js";import"./shield-CQ-AXaLs.js";import"./square-pen-D5JRiJpv.js";import"./info-Cu4eEvQq.js";import"./calendar-NzJ3-Hzp.js";import"./house-CZga5bkn.js";import"./book-open-NJHJ4pEX.js";import"./trash-Byk8sBRk.js";const oe={class:"max-w-2xl mx-auto w-full px-2 sm:px-4 md:px-0 py-8"},le={class:"mb-6 p-4 rounded-lg bg-purple-50 dark:bg-purple-900/20 border border-purple-200 dark:border-purple-800"},ae={class:"flex items-center justify-between"},ne={class:"text-sm text-purple-700 dark:text-purple-300"},de={key:0,class:"text-xs text-orange-600 dark:text-orange-400"},ie={class:"bg-white dark:bg-neutral-900 rounded-lg shadow border border-gray-200 dark:border-neutral-800"},ue={class:"p-6"},pe={class:"space-y-4"},ce={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},me={key:0,class:"text-xs text-red-500 mt-1"},ge={key:0,class:"text-xs text-red-500 mt-1"},xe={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},be={key:0,class:"text-xs text-red-500 mt-1"},fe={key:0,class:"text-xs text-red-500 mt-1"},ye={class:"space-y-2"},ve={class:"relative"},he=["type"],ke={key:0,class:"text-xs text-red-500 mt-1"},we={class:"space-y-3"},_e={key:0,class:"flex items-center space-x-3"},Ue=["src"],Ce={class:"flex-1"},Pe={class:"text-sm text-gray-600 dark:text-gray-400"},Se={key:1,class:"flex items-center justify-center w-full"},Ne={class:"flex flex-col items-center justify-center w-full h-32 border-2 border-gray-300 dark:border-neutral-600 border-dashed rounded-lg cursor-pointer bg-gray-50 dark:bg-neutral-800 hover:bg-gray-100 dark:hover:bg-neutral-700"},Ee={class:"flex flex-col items-center justify-center pt-5 pb-6"},Ae={key:0,class:"text-xs text-red-500 mt-1"},Me={class:"space-y-4"},Ve={value:"",disabled:""},Ie=["value"],je={key:0,class:"text-xs text-red-500 mt-1"},Re={key:1,class:"text-xs text-orange-600 dark:text-orange-400 mt-1"},Be={key:0,class:"p-3 bg-gray-50 dark:bg-neutral-800 rounded-lg"},Fe={class:"text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"},qe={class:"flex flex-wrap gap-2"},ze={class:"flex justify-end gap-3 pt-4 border-t border-gray-200 dark:border-neutral-700"},De=["disabled"],Le={key:0,class:"animate-spin h-4 w-4",fill:"none",viewBox:"0 0 24 24"},Te={key:0,class:"mt-6 p-4 rounded-lg bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800"},$e={class:"flex items-start"},Ge={class:"text-sm text-green-700 dark:text-green-300 space-y-2"},ht=H({__name:"AddUser",props:{roles:{},schools:{},auth:{}},setup(F){const A=F,f=m(!1),y=m(""),v=m(""),U=m(""),C=m(),x=m(!1),q=m(A.roles||[]);S(()=>A.schools||[]);const z=ee(),{selectedSchool:u}=O(z),r=W({name:"",username:"",email:"",phone:"",password:"",profile_photo:null,role_name:"",school_id:null}),h=S(()=>{if(!u.value||typeof u.value.id!="number")return[];const i=u.value.id;return q.value.filter(t=>t.school_id===i&&t.name!=="superadmin")}),M=S(()=>r.name.trim()&&r.username.trim()&&r.email.trim()&&r.phone.trim()&&r.profile_photo&&r.role_name&&u.value&&h.value.length>0),D=i=>{var k;const p=(k=i.target.files)==null?void 0:k[0];if(p){if(!p.type.startsWith("image/")){g.error("Please select a valid image file");return}if(p.size>2*1024*1024){g.error("Image size must be less than 2MB");return}const w=new FileReader;w.onload=o=>{var I;v.value=(I=o.target)==null?void 0:I.result,U.value=p.name},w.readAsDataURL(p),r.profile_photo=p}},V=()=>{v.value="",U.value="",r.profile_photo=null,C.value&&(C.value.value="")},L=()=>{const i="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789!@#$%^&*";let t="";for(let p=0;p<12;p++)t+=i.charAt(Math.floor(Math.random()*i.length));r.password=t,x.value=!0},T=()=>{r.password="",x.value=!1},$=()=>{if(!M.value){g.error("Please fill in all required fields and select a school with available roles.");return}if(r.school_id=u.value&&typeof u.value.id=="number"?u.value.id:null,!r.school_id){g.error("No school selected for user creation.");return}f.value=!0,y.value="",r.post("/settings/user-management/create",{preserveScroll:!0,onSuccess:i=>{console.log("User creation response:",i);const t=i.props.flash;t&&t.success?(y.value=t.success,g.success("User created successfully!"),P()):(g.success("User created successfully!"),P())},onError:i=>{console.error("User creation errors:",i),Object.values(i).flat().forEach(t=>{typeof t=="string"&&g.error(t)})},onFinish:()=>{f.value=!1}})},P=()=>{r.reset(),r.school_id=null,y.value="",V()},G=[{title:"Settings",href:"/settings/profile"},{title:"Add New User",href:"/settings/add-user"}];return(i,t)=>(l(),N(Y,{breadcrumbs:G},{default:j(()=>[E(s(J),{title:"Add New User"}),E(Z,null,{default:j(()=>{var p,k,w;return[e("div",oe,[t[25]||(t[25]=e("h1",{class:"text-2xl font-bold mb-6"},"Add New User",-1)),t[26]||(t[26]=e("div",{class:"mb-6 p-4 rounded-lg bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800"},[e("h3",{class:"text-sm font-semibold text-blue-800 dark:text-blue-200 mb-2"},"How User Creation Works"),e("div",{class:"text-sm text-blue-700 dark:text-blue-300 space-y-1"},[e("p",null,"• Select a school from the global school selector to create a user for that school"),e("p",null,"• Users are automatically assigned the selected role for the chosen school"),e("p",null,"• A temporary password is generated and shown after successful creation"),e("p",null,"• Users can only have roles from one school at a time"),e("p",null,"• Super admin role cannot be assigned during user creation")])],-1)),e("div",le,[e("div",ae,[e("div",null,[t[7]||(t[7]=e("h3",{class:"text-sm font-semibold text-purple-800 dark:text-purple-200 mb-1"},"Current School Context",-1)),e("div",ne,n(((p=s(u))==null?void 0:p.name)||"No school selected"),1),t[8]||(t[8]=e("div",{class:"text-xs text-purple-600 dark:text-purple-400 mt-1"}," User will be created for this school ",-1))]),s(u)?d("",!0):(l(),a("div",de," Please select a school first "))])]),e("div",ie,[e("div",ue,[e("form",{onSubmit:K($,["prevent"]),class:"space-y-6",enctype:"multipart/form-data"},[e("div",pe,[t[18]||(t[18]=e("h3",{class:"text-lg font-semibold text-gray-900 dark:text-gray-100"},"User Information",-1)),e("div",ce,[e("div",null,[t[9]||(t[9]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"},[c(" Full Name "),e("span",{class:"text-red-500"},"*")],-1)),b(e("input",{"onUpdate:modelValue":t[0]||(t[0]=o=>s(r).name=o),type:"text",required:"",class:"w-full px-3 py-2 rounded-lg border border-gray-300 dark:border-neutral-600 bg-white dark:bg-neutral-700 text-gray-900 dark:text-gray-100 focus:outline-none focus:ring-2 focus:ring-purple-400 focus:border-transparent",placeholder:"Enter full name"},null,512),[[_,s(r).name]]),s(r).errors.name?(l(),a("div",me,n(s(r).errors.name),1)):d("",!0)]),e("div",null,[t[10]||(t[10]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"},[c(" Username "),e("span",{class:"text-red-500"},"*")],-1)),b(e("input",{"onUpdate:modelValue":t[1]||(t[1]=o=>s(r).username=o),type:"text",required:"",class:"w-full px-3 py-2 rounded-lg border border-gray-300 dark:border-neutral-600 bg-white dark:bg-neutral-700 text-gray-900 dark:text-gray-100 focus:outline-none focus:ring-2 focus:ring-purple-400 focus:border-transparent",placeholder:"Enter username"},null,512),[[_,s(r).username]]),s(r).errors.username?(l(),a("div",ge,n(s(r).errors.username),1)):d("",!0)])]),e("div",xe,[e("div",null,[t[11]||(t[11]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"},[c(" Email Address "),e("span",{class:"text-red-500"},"*")],-1)),b(e("input",{"onUpdate:modelValue":t[2]||(t[2]=o=>s(r).email=o),type:"email",required:"",class:"w-full px-3 py-2 rounded-lg border border-gray-300 dark:border-neutral-600 bg-white dark:bg-neutral-700 text-gray-900 dark:text-gray-100 focus:outline-none focus:ring-2 focus:ring-purple-400 focus:border-transparent",placeholder:"Enter email address"},null,512),[[_,s(r).email]]),s(r).errors.email?(l(),a("div",be,n(s(r).errors.email),1)):d("",!0)]),e("div",null,[t[12]||(t[12]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"},[c(" Phone Number "),e("span",{class:"text-red-500"},"*")],-1)),b(e("input",{"onUpdate:modelValue":t[3]||(t[3]=o=>s(r).phone=o),type:"text",required:"",class:"w-full px-3 py-2 rounded-lg border border-gray-300 dark:border-neutral-600 bg-white dark:bg-neutral-700 text-gray-900 dark:text-gray-100 focus:outline-none focus:ring-2 focus:ring-purple-400 focus:border-transparent",placeholder:"Enter phone number"},null,512),[[_,s(r).phone]]),s(r).errors.phone?(l(),a("div",fe,n(s(r).errors.phone),1)):d("",!0)])]),e("div",null,[t[14]||(t[14]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"},[c(" Password "),e("span",{class:"text-red-500"},"*")],-1)),e("div",ye,[e("div",ve,[b(e("input",{"onUpdate:modelValue":t[4]||(t[4]=o=>s(r).password=o),type:x.value?"text":"password",required:"",class:"w-full px-3 py-2 pr-10 rounded-lg border border-gray-300 dark:border-neutral-600 bg-white dark:bg-neutral-700 text-gray-900 dark:text-gray-100 focus:outline-none focus:ring-2 focus:ring-purple-400 focus:border-transparent",placeholder:"Enter password or leave empty for auto-generation"},null,8,he),[[Q,s(r).password]]),e("button",{type:"button",onClick:t[5]||(t[5]=o=>x.value=!x.value),class:"absolute right-2 top-1/2 transform -translate-y-1/2 text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200"},[x.value?(l(),N(s(se),{key:1,class:"w-4 h-4"})):(l(),N(s(re),{key:0,class:"w-4 h-4"}))])]),e("div",{class:"flex gap-2"},[e("button",{type:"button",onClick:L,class:"px-3 py-1 text-xs bg-blue-500 text-white rounded hover:bg-blue-600 transition-colors"}," Generate Password "),e("button",{type:"button",onClick:T,class:"px-3 py-1 text-xs bg-gray-500 text-white rounded hover:bg-gray-600 transition-colors"}," Clear ")]),t[13]||(t[13]=e("p",{class:"text-xs text-gray-600 dark:text-gray-400"}," Leave empty to auto-generate a secure password, or enter a custom password (minimum 8 characters) ",-1))]),s(r).errors.password?(l(),a("div",ke,n(s(r).errors.password),1)):d("",!0)]),e("div",null,[t[17]||(t[17]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"},[c(" Profile Photo "),e("span",{class:"text-red-500"},"*")],-1)),e("div",we,[v.value?(l(),a("div",_e,[e("img",{src:v.value,alt:"Profile preview",class:"w-16 h-16 rounded-full object-cover border-2 border-gray-300 dark:border-neutral-600"},null,8,Ue),e("div",Ce,[e("p",Pe,n(U.value),1),e("button",{type:"button",onClick:V,class:"text-xs text-red-600 dark:text-red-400 hover:text-red-800 dark:hover:text-red-300"}," Remove image ")])])):d("",!0),v.value?d("",!0):(l(),a("div",Se,[e("label",Ne,[e("div",Ee,[E(te,{name:"Upload",class:"w-8 h-8 mb-4 text-gray-500 dark:text-gray-400"}),t[15]||(t[15]=e("p",{class:"mb-2 text-sm text-gray-500 dark:text-gray-400"},[e("span",{class:"font-semibold"},"Click to upload"),c(" or drag and drop ")],-1)),t[16]||(t[16]=e("p",{class:"text-xs text-gray-500 dark:text-gray-400"},"PNG, JPG up to 2MB",-1))]),e("input",{ref_key:"fileInput",ref:C,type:"file",class:"hidden",accept:"image/*",onChange:D},null,544)])]))]),s(r).errors.profile_photo?(l(),a("div",Ae,n(s(r).errors.profile_photo),1)):d("",!0)])]),e("div",Me,[t[20]||(t[20]=e("h3",{class:"text-lg font-semibold text-gray-900 dark:text-gray-100"},"Role Assignment",-1)),e("div",null,[t[19]||(t[19]=e("label",{class:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2"},[c(" Role "),e("span",{class:"text-red-500"},"*")],-1)),b(e("select",{"onUpdate:modelValue":t[6]||(t[6]=o=>s(r).role_name=o),required:"",class:"w-full px-3 py-2 rounded-lg border border-gray-300 dark:border-neutral-600 bg-white dark:bg-neutral-700 text-gray-900 dark:text-gray-100 focus:outline-none focus:ring-2 focus:ring-purple-400 focus:border-transparent"},[e("option",Ve," Select a role for "+n(((k=s(u))==null?void 0:k.name)||"selected school"),1),(l(!0),a(R,null,B(h.value,o=>(l(),a("option",{key:o.id,value:o.name},n(o.name),9,Ie))),128))],512),[[X,s(r).role_name]]),s(r).errors.role_name?(l(),a("div",je,n(s(r).errors.role_name),1)):d("",!0),h.value.length===0&&s(u)?(l(),a("div",Re," No roles available for the selected school. Please create roles for this school first. ")):d("",!0)]),h.value.length>0?(l(),a("div",Be,[e("h4",Fe,"Available Roles for "+n((w=s(u))==null?void 0:w.name),1),e("div",qe,[(l(!0),a(R,null,B(h.value,o=>(l(),a("span",{key:o.id,class:"inline-flex items-center px-2.5 py-1 rounded-full text-xs font-medium bg-purple-100 dark:bg-purple-900/30 text-purple-800 dark:text-purple-200 border border-purple-200 dark:border-purple-800"},n(o.name),1))),128))])])):d("",!0)]),e("div",ze,[e("button",{type:"button",onClick:P,class:"px-4 py-2 rounded-lg bg-gray-200 dark:bg-neutral-700 text-gray-700 dark:text-white hover:bg-gray-300 dark:hover:bg-neutral-600 transition-colors"}," Reset Form "),e("button",{type:"submit",disabled:!M.value||f.value,class:"px-6 py-2 rounded-lg bg-purple-600 text-white hover:bg-purple-700 disabled:opacity-50 disabled:cursor-not-allowed transition-colors flex items-center gap-2"},[f.value?(l(),a("svg",Le,t[21]||(t[21]=[e("circle",{class:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor","stroke-width":"4"},null,-1),e("path",{class:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"},null,-1)]))):d("",!0),c(" "+n(f.value?"Creating User...":"Create User"),1)],8,De)])],32)])]),y.value?(l(),a("div",Te,[e("div",$e,[t[24]||(t[24]=e("svg",{class:"w-5 h-5 text-green-600 dark:text-green-400 mt-0.5 mr-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})],-1)),e("div",null,[t[23]||(t[23]=e("h3",{class:"text-sm font-semibold text-green-800 dark:text-green-200 mb-1"},"User Created Successfully!",-1)),e("div",Ge,[e("p",null,n(y.value),1),t[22]||(t[22]=e("div",{class:"bg-yellow-50 dark:bg-yellow-900/20 p-3 rounded border border-yellow-200 dark:border-yellow-800"},[e("p",{class:"text-xs font-medium text-yellow-800 dark:text-yellow-200 mb-1"},"Important: "),e("p",{class:"text-xs text-yellow-700 dark:text-yellow-300"},"Please save this temporary password. The user will need it to log in for the first time.")],-1))])])])])):d("",!0)])]}),_:1})]),_:1}))}});export{ht as default};
