import{d as N,aj as ge,ai as ye,a8 as he,a2 as X,b as B,o as i,e as v,M as V,u as t,a5 as Y,aD as xe,r as f,c as Q,w as oe,S as _e,H as ae,ah as ke,f as u,a4 as W,z as E,az as Ce,aw as we,i as g,g as o,A as q,x as M,L as $e,h as Pe,j as S,t as O,p as z,_ as H,F as J,m as K,E as Re,B as Se,C as Ae,l as C,W as Be}from"./app-0hD9jktS.js";import{_ as je}from"./AppLayout.vue_vue_type_script_setup_true_lang-C_OfVMdc.js";import{_ as Fe}from"./Layout.vue_vue_type_script_setup_true_lang-Bi3HrDun.js";import{C as Oe}from"./check-DytFQTDT.js";import{_ as L}from"./InputError.vue_vue_type_script_setup_true_lang-BnFbo3YU.js";import{_ as ee}from"./Input.vue_vue_type_script_setup_true_lang-ByoFr_iA.js";import{_ as Ee}from"./Label.vue_vue_type_script_setup_true_lang-CLv8w6I-.js";import{u as Ne}from"./school-SWVnhMs_.js";import{P as se}from"./plus-DX8dkZyx.js";import{T as te}from"./trash-2-Ctjd7__o.js";import"./RovingFocusGroup-BrsbekXI.js";import"./AvatarImage.vue_vue_type_script_setup_true_lang-DLhJV-ve.js";import"./AppLogo.vue_vue_type_script_setup_true_lang-DV00-4L5.js";import"./building-2-0J7JWYjO.js";import"./users-CQiJNf1m.js";import"./chevron-down-Bc9-FnA7.js";const[ne,Te]=he("CollapsibleRoot"),De=N({__name:"CollapsibleRoot",props:{defaultOpen:{type:Boolean,default:!1},open:{type:Boolean,default:void 0},disabled:{type:Boolean},unmountOnHide:{type:Boolean,default:!0},asChild:{type:Boolean},as:{}},emits:["update:open"],setup(h,{expose:r,emit:n}){const m=h,p=ge(m,"open",n,{defaultValue:m.defaultOpen,passive:m.open===void 0}),{disabled:y,unmountOnHide:x}=ye(m);return Te({contentId:"",disabled:y,open:p,unmountOnHide:x,onOpenToggle:()=>{y.value||(p.value=!p.value)}}),r({open:p}),X(),(w,A)=>(i(),B(t(Y),{as:w.as,"as-child":m.asChild,"data-state":t(p)?"open":"closed","data-disabled":t(y)?"":void 0},{default:v(()=>[V(w.$slots,"default",{open:t(p)})]),_:3},8,["as","as-child","data-state","data-disabled"]))}}),Ie=N({inheritAttrs:!1,__name:"CollapsibleContent",props:{forceMount:{type:Boolean},asChild:{type:Boolean},as:{}},emits:["contentFound"],setup(h,{emit:r}){const n=h,m=r,l=ne();l.contentId||(l.contentId=xe(void 0,"reka-collapsible-content"));const p=f(),{forwardRef:y,currentElement:x}=X(),w=f(0),A=f(0),$=Q(()=>l.open.value),P=f($.value),_=f();oe(()=>{var d;return[$.value,(d=p.value)==null?void 0:d.present]},async()=>{await _e();const d=x.value;if(!d)return;_.value=_.value||{transitionDuration:d.style.transitionDuration,animationName:d.style.animationName},d.style.transitionDuration="0s",d.style.animationName="none";const D=d.getBoundingClientRect();A.value=D.height,w.value=D.width,P.value||(d.style.transitionDuration=_.value.transitionDuration,d.style.animationName=_.value.animationName)},{immediate:!0});const R=Q(()=>P.value&&l.open.value);return ae(()=>{requestAnimationFrame(()=>{P.value=!1})}),ke(x,"beforematch",d=>{requestAnimationFrame(()=>{l.onOpenToggle(),m("contentFound")})}),(d,D)=>(i(),B(t(Ce),{ref_key:"presentRef",ref:p,present:d.forceMount||t(l).open.value,"force-mount":!0},{default:v(({present:j})=>{var U;return[u(t(Y),W(d.$attrs,{id:t(l).contentId,ref:t(y),"as-child":n.asChild,as:d.as,hidden:j?void 0:t(l).unmountOnHide.value?"":"until-found","data-state":R.value?void 0:t(l).open.value?"open":"closed","data-disabled":(U=t(l).disabled)!=null&&U.value?"":void 0,style:{"--reka-collapsible-content-height":`${A.value}px`,"--reka-collapsible-content-width":`${w.value}px`}}),{default:v(()=>[!t(l).unmountOnHide.value||j?V(d.$slots,"default",{key:0}):E("",!0)]),_:2},1040,["id","as-child","as","hidden","data-state","data-disabled","style"])]}),_:3},8,["present"]))}}),Ve=N({__name:"CollapsibleTrigger",props:{asChild:{type:Boolean},as:{default:"button"}},setup(h){const r=h;X();const n=ne();return(m,l)=>{var p,y;return i(),B(t(Y),{type:m.as==="button"?"button":void 0,as:m.as,"as-child":r.asChild,"aria-controls":t(n).contentId,"aria-expanded":t(n).open.value,"data-state":t(n).open.value?"open":"closed","data-disabled":(p=t(n).disabled)!=null&&p.value?"":void 0,disabled:(y=t(n).disabled)==null?void 0:y.value,onClick:t(n).onOpenToggle},{default:v(()=>[V(m.$slots,"default")]),_:3},8,["type","as","as-child","aria-controls","aria-expanded","data-state","data-disabled","disabled","onClick"])}}}),Me=N({__name:"Collapsible",props:{defaultOpen:{type:Boolean},open:{type:Boolean},disabled:{type:Boolean},unmountOnHide:{type:Boolean},asChild:{type:Boolean},as:{type:[String,Object,Function]}},emits:["update:open"],setup(h,{emit:r}){const l=we(h,r);return(p,y)=>(i(),B(t(De),W({"data-slot":"collapsible"},t(l)),{default:v(({open:x})=>[V(p.$slots,"default",{open:x})]),_:3},16))}}),Ue=N({__name:"CollapsibleTrigger",props:{asChild:{type:Boolean},as:{type:[String,Object,Function]}},setup(h){const r=h;return(n,m)=>(i(),B(t(Ve),W({"data-slot":"collapsible-trigger"},r),{default:v(()=>[V(n.$slots,"default")]),_:3},16))}}),ze=N({__name:"CollapsibleContent",props:{forceMount:{type:Boolean},asChild:{type:Boolean},as:{type:[String,Object,Function]}},setup(h){const r=h;return(n,m)=>(i(),B(t(Ie),W({"data-slot":"collapsible-content"},r),{default:v(()=>[V(n.$slots,"default")]),_:3},16))}}),He=["aria-checked","disabled"],Le=N({__name:"Switch",props:{checked:Boolean,disabled:Boolean,class:String},emits:["update:checked"],setup(h,{emit:r}){const n=h,m=r,l=f(n.checked);oe(()=>n.checked,y=>{l.value=y});const p=()=>{n.disabled||(l.value=!l.value,m("update:checked",l.value))};return(y,x)=>(i(),g("button",{type:"button",class:q(["relative inline-flex h-7 w-14 items-center rounded-full transition-colors focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 ",l.value?"bg-[#7c3aed]":"bg-gray-200 dark:bg-neutral-700",n.disabled?"opacity-50 cursor-not-allowed":"cursor-pointer",n.class]),"aria-checked":l.value,disabled:n.disabled,role:"switch",onClick:p},[o("span",{class:q([" h-6 w-6 rounded-full  transition-all duration-200 flex items-center justify-center",l.value?"translate-x-7 bg-white dark:bg-neutral-100 text-[#7c3aed]":"translate-x-1 bg-white dark:bg-neutral-100"])},[l.value?(i(),B(t(Oe),{key:0,class:"w-4 h-4"})):E("",!0)],2)],10,He))}}),qe={class:"max-w-2xl mx-auto w-full px-2 sm:px-4 md:px-0 py-8"},We={class:"mb-6 flex gap-4 border-b border-gray-200 dark:border-neutral-800"},Ge={key:0},Je={class:"mb-4 p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg border border-blue-200 dark:border-blue-800"},Ke={class:"text-sm text-blue-800 dark:text-blue-200"},Qe={class:"flex justify-end mb-4"},Xe={key:0,class:"w-lg mb-4"},Ye={class:"text-xs text-gray-600 dark:text-gray-400 mb-2"},Ze={class:"font-medium text-blue-600 dark:text-blue-400"},es={key:1,class:"text-center py-8 text-muted-foreground"},ss={key:2,class:"space-y-4"},ts={class:"flex items-center gap-3"},os={class:"font-medium text-base"},as={class:"text-xs px-2 py-1 rounded-full bg-blue-100 dark:bg-blue-900/30 text-blue-800 dark:text-blue-200 border border-blue-200 dark:border-blue-800"},ns={class:"flex flex-row gap-3 items-center"},ls={class:"text-xs text-muted-foreground"},is=["onClick"],rs={class:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-2"},ds={class:"text-sm"},us={key:0,class:"text-xs text-muted-foreground ml-2"},cs={key:1,class:"text-xs text-green-600 dark:text-green-400 ml-2"},ms={key:1},ps={class:"flex justify-end mb-4"},fs={class:"flex gap-2 justify-end"},vs={key:0,class:"text-center py-8 text-muted-foreground"},bs={key:1,class:"space-y-2"},gs={class:"text-sm flex-1"},ys=["onClick"],hs={key:2,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/40"},xs={class:"bg-white dark:bg-neutral-900 rounded-lg shadow-lg p-6 w-full max-w-sm mx-auto"},_s={class:"flex gap-2 justify-end"},ks={key:3,class:"fixed inset-0 z-50 flex items-center justify-center bg-black/40"},Cs={class:"bg-white dark:bg-neutral-900 rounded-lg shadow-lg p-6 w-full max-w-sm mx-auto"},ws={class:"flex gap-2 justify-end"},Us=N({__name:"RolesPermissions",setup(h){const r=f([]),n=f([]),m=f(!0);f(null);const l=f({}),p=f({}),y=f(""),x=f({}),w=f(!1);f(!1);const A=f(!1),$=M({name:"",school_id:null}),P=M({name:"",userName:"",phoneNumber:""}),_=f(null),R=f(null),d=f("roles"),D=Ne(),{selectedSchool:j,schools:U}=$e(D),le=Q(()=>j.value?r.value.filter(s=>{var e;return s.school_id===((e=j.value)==null?void 0:e.id)||!s.school_id}):r.value),ie=async()=>{m.value=!0;const[s,e]=await Promise.all([fetch("/admin/roles"),fetch("/admin/permissions")]);r.value=await s.json(),n.value=await e.json(),m.value=!1};ae(()=>{ie(),fetch("/admin/schools").then(s=>s.json()).then(s=>{const e=s.schools;if(!Array.isArray(e)){console.error("Expected an array for schools, but got:",s);return}U.value=e;const b=localStorage.getItem("selectedSchoolId"),k=e.find(a=>a.id===Number(b));D.setSchool(k||e[0])}).catch(s=>{console.error("Error fetching schools:",s)})});const Z=(s,e)=>Array.isArray(s.permissions)&&s.permissions.some(b=>b.id===e),re=s=>(x.value[s.id]||(x.value[s.id]=M({permissions:Array.isArray(s.permissions)?s.permissions.map(e=>e.id):[]})),x.value[s.id]),de=async(s,e)=>{const b=`${s.id}-${e.id}`;l.value[b]=!0,y.value="";const k=re(s),a=Z(s,e.id);a?k.permissions=k.permissions.filter(c=>c!==e.id):k.permissions=[...k.permissions,e.id],k.permissions,k.put(`/admin/roles/${s.id}`,{preserveScroll:!0,only:["permissions"],onSuccess:c=>{if(c&&c.props&&c.props.role){const F=c.props.role,I=r.value.findIndex(G=>G.id===s.id);I!==-1&&(r.value[I].permissions=F.permissions,x.value[s.id]&&(x.value[s.id].permissions=F.permissions.map(G=>G.id)))}else{const F=r.value.findIndex(I=>I.id===s.id);F!==-1&&(r.value[F].permissions=n.value.filter(I=>k.permissions.includes(I.id)))}a?C.info(`'${T(e.name)}' removed from '${T(s.name)}'`):C.success(`'${T(e.name)}' assigned to '${T(s.name)}'`),l.value[b]=!1,p.value[b]=!0,setTimeout(()=>{p.value[b]=!1},1200),Be.visit(route("roles.settings"),{preserveState:!0,preserveScroll:!0})},onError:c=>{var F;l.value[b]=!1,y.value=((F=c==null?void 0:c.permissions)==null?void 0:F[0])||"Failed to update permissions. Please refresh and try again.",C.error(y.value)}})};function T(s){return s.charAt(0).toUpperCase()+s.slice(1)}const ue=()=>{var s;$.school_id=((s=j.value)==null?void 0:s.id)||null,$.post("/admin/roles",{preserveScroll:!0,onSuccess:e=>{C.success("Role added!"),w.value=!1,$.reset(),e&&e.props&&e.props.role?r.value.push(e.props.role):fetch("/admin/roles").then(b=>b.json()).then(b=>{r.value=b})},onError:e=>{Object.values(e).flat().forEach(b=>C.error(b))}})},ce=()=>{P.post("/admin/permissions",{preserveScroll:!0,onSuccess:s=>{C.success("Permission added!"),A.value=!1,P.reset(),s&&s.props&&s.props.permission?n.value.push(s.props.permission):fetch("/admin/permissions").then(e=>e.json()).then(e=>{n.value=e})},onError:s=>{Object.values(s).flat().forEach(e=>C.error(e))}})},me=s=>{_.value=s},pe=s=>{R.value=s},fe=()=>{_.value&&M({id:_.value,name:""}).delete(`/admin/roles/${_.value}`,{preserveScroll:!0,onSuccess:()=>{C.success("Role deleted!"),r.value=r.value.filter(s=>s.id!==_.value),_.value=null},onError:()=>C.error("Failed to delete role!")})},ve=()=>{R.value&&M({id:R.value,name:""}).delete(`/admin/permissions/${R.value}`,{preserveScroll:!0,onSuccess:()=>{C.success("Permission deleted!"),n.value=n.value.filter(s=>s.id!==R.value),R.value=null},onError:()=>C.error("Failed to delete permission!")})},be=[{title:"Roles and Permissions settings",href:"/settings/roles-permissions"}];return(s,e)=>(i(),B(je,{breadcrumbs:be},{default:v(()=>[u(t(Pe),{title:"Roles & Permissions"}),u(Fe,null,{default:v(()=>{var b,k;return[o("div",qe,[e[28]||(e[28]=o("h1",{class:"text-2xl font-bold mb-6"},"Roles & Permissions",-1)),o("div",We,[o("button",{class:q(["px-4 py-2 font-semibold",d.value==="roles"?"border-b-2 border-primary text-primary":"text-gray-500"]),onClick:e[0]||(e[0]=a=>d.value="roles")},"Roles",2),o("button",{class:q(["px-4 py-2 font-semibold",d.value==="permissions"?"border-b-2 border-primary text-primary":"text-gray-500"]),onClick:e[1]||(e[1]=a=>d.value="permissions")},"Permissions",2)]),d.value==="roles"?(i(),g("div",Ge,[e[17]||(e[17]=o("p",{class:"mb-4 text-sm text-muted-foreground"},"Roles let you group permissions and assign them to users. Expand a role to manage its permissions.",-1)),o("div",Je,[o("div",Ke,[e[11]||(e[11]=o("span",{class:"font-medium"},"Current School Context:",-1)),S(" "+O(((b=t(j))==null?void 0:b.name)||"No school selected"),1)]),e[12]||(e[12]=o("div",{class:"text-xs text-blue-600 dark:text-blue-400 mt-1"}," Showing roles for this school and global roles ",-1))]),o("div",Qe,[o("button",{onClick:e[2]||(e[2]=a=>w.value=!0),class:"flex items-center gap-2 px-3 py-1.5 rounded shadow bg-gray-100 dark:bg-neutral-800 hover:bg-gray-200 dark:hover:bg-neutral-700 transition"},[u(t(se),{class:"w-4 h-4"}),e[13]||(e[13]=S(" Add Role "))])]),w.value?(i(),g("div",Xe,[o("form",{onSubmit:z(ue,["prevent"]),class:"flex gap-2 items-center"},[o("div",Ye,[e[14]||(e[14]=S(" Creating role for: ")),o("span",Ze,O(((k=t(j))==null?void 0:k.name)||"No school selected"),1)]),u(t(ee),{id:"role_name",modelValue:t($).name,"onUpdate:modelValue":e[3]||(e[3]=a=>t($).name=a),placeholder:"Role name",class:"rounded border px-3 py-1 text-sm"},null,8,["modelValue"]),u(L,{message:t($).errors.name},null,8,["message"]),u(L,{message:t($).errors.school_id},null,8,["message"]),u(t(H),{type:"submit",class:"px-3 py-1"},{default:v(()=>e[15]||(e[15]=[S("Add")])),_:1,__:[15]}),u(t(H),{type:"button",onClick:e[4]||(e[4]=a=>w.value=!1),variant:"outline"},{default:v(()=>e[16]||(e[16]=[S("Cancel")])),_:1,__:[16]})],32)])):E("",!0),m.value?(i(),g("div",es,"Loading roles...")):(i(),g("div",ss,[(i(!0),g(J,null,K(le.value,a=>(i(),B(Me,{key:a.id},{default:v(()=>[u(Ue,{class:"w-full flex items-center justify-between px-4 py-3 rounded cursor-pointer bg-gray-100 dark:bg-neutral-800 hover:bg-gray-200 dark:hover:bg-neutral-700 transition"},{default:v(()=>[o("div",ts,[o("span",os,O(T(a.name)),1),o("span",as,O(a.school_name||"Global"),1)]),o("div",ns,[o("span",ls,O(Array.isArray(a.permissions)?a.permissions.length:0)+" permission"+O(Array.isArray(a.permissions)&&a.permissions.length===1?"":"s"),1),["superadmin","admin","teacher","principal"].includes(a.name.toLowerCase())?E("",!0):(i(),g("button",{key:0,onClick:z(c=>me(a.id),["stop"]),class:"ml-2 p-1 rounded hover:bg-red-100 dark:hover:bg-red-900 transition"},[u(t(te),{class:"w-4 h-4 text-red-500"})],8,is))])]),_:2},1024),u(ze,{class:"px-4 py-3 border-t border-gray-200 dark:border-neutral-800 bg-gray-50 dark:bg-neutral-900"},{default:v(()=>[o("div",rs,[(i(!0),g(J,null,K(n.value,c=>(i(),g("div",{key:c.id,class:"flex items-center gap-3"},[u(Le,{checked:Z(a,c.id),disabled:l.value[`${a.id}-${c.id}`],"onUpdate:checked":()=>de(a,c),class:"size-5"},null,8,["checked","disabled","onUpdate:checked"]),o("span",ds,O(T(c.name)),1),l.value[`${a.id}-${c.id}`]?(i(),g("span",us,"Updating...")):p.value[`${a.id}-${c.id}`]?(i(),g("span",cs,"Updated!")):E("",!0)]))),128))])]),_:2},1024)]),_:2},1024))),128))]))])):d.value==="permissions"?(i(),g("div",ms,[e[23]||(e[23]=o("p",{class:"mb-4 text-sm text-muted-foreground"},"Permissions control what users can do. Add, view, or delete permissions here.",-1)),o("div",ps,[o("button",{onClick:e[5]||(e[5]=a=>A.value=!0),class:"flex items-center gap-2 px-3 py-1.5 rounded shadow bg-gray-100 dark:bg-neutral-800 hover:bg-gray-200 dark:hover:bg-neutral-700 transition"},[u(t(se),{class:"w-4 h-4"}),e[18]||(e[18]=S(" Add Permission "))])]),u(Re,{open:A.value,"onUpdate:open":e[8]||(e[8]=a=>A.value=a)},{default:v(()=>[u(Se,null,{default:v(()=>{var a;return[u(Ae,null,{default:v(()=>e[19]||(e[19]=[S("Add Permission")])),_:1,__:[19]}),o("form",{onSubmit:z(ce,["prevent"]),class:"flex flex-col gap-3"},[u(L,{message:t(P).errors.name||y.value||((a=s.$page.props.errors)==null?void 0:a.name),class:"mb-2"},null,8,["message"]),u(t(Ee),{for:"perm_name"},{default:v(()=>e[20]||(e[20]=[S("Permission Name")])),_:1,__:[20]}),u(t(ee),{id:"perm_name",modelValue:t(P).name,"onUpdate:modelValue":e[6]||(e[6]=c=>t(P).name=c),placeholder:"Permission name",class:"rounded border px-3 py-2 text-sm"},null,8,["modelValue"]),u(L,{message:t(P).errors.name},null,8,["message"]),o("div",fs,[u(t(H),{type:"button",onClick:e[7]||(e[7]=c=>A.value=!1),variant:"outline"},{default:v(()=>e[21]||(e[21]=[S("Cancel")])),_:1,__:[21]}),u(t(H),{type:"submit"},{default:v(()=>e[22]||(e[22]=[S("Add")])),_:1,__:[22]})])],32)]}),_:1})]),_:1},8,["open"]),m.value?(i(),g("div",vs,"Loading permissions...")):(i(),g("div",bs,[(i(!0),g(J,null,K(n.value,a=>(i(),g("div",{key:a.id,class:"flex items-center gap-3 bg-gray-50 dark:bg-neutral-900 rounded px-4 py-2"},[o("span",gs,O(T(a.name)),1),o("button",{onClick:z(c=>pe(a.id),["stop"]),class:"ml-1 p-1 rounded hover:bg-red-100 dark:hover:bg-red-900 transition"},[u(t(te),{class:"w-4 h-4 text-red-500"})],8,ys)]))),128))]))])):E("",!0),_.value!==null?(i(),g("div",hs,[o("div",xs,[e[24]||(e[24]=o("h3",{class:"text-lg font-semibold mb-4"},"Delete Role?",-1)),e[25]||(e[25]=o("p",{class:"mb-4"},"Are you sure you want to delete this role? This action cannot be undone.",-1)),o("div",_s,[o("button",{class:"px-4 py-2 rounded bg-gray-200 dark:bg-neutral-800",onClick:e[9]||(e[9]=a=>_.value=null)},"Cancel"),o("button",{class:"px-4 py-2 rounded bg-red-600 text-white",onClick:fe},"Delete")])])])):E("",!0),R.value!==null?(i(),g("div",ks,[o("div",Cs,[e[26]||(e[26]=o("h3",{class:"text-lg font-semibold mb-4"},"Delete Permission?",-1)),e[27]||(e[27]=o("p",{class:"mb-4"},"Are you sure you want to delete this permission? This action cannot be undone. ",-1)),o("div",ws,[o("button",{class:"px-4 py-2 rounded bg-gray-200 dark:bg-neutral-800",onClick:e[10]||(e[10]=a=>R.value=null)},"Cancel"),o("button",{class:"px-4 py-2 rounded bg-red-600 text-white",onClick:ve},"Delete")])])])):E("",!0)])]}),_:1})]),_:1}))}});export{Us as default};
