import{d as M,r as z,x as A,G as L,c as O,w as T,y as W,b as v,o as i,e as c,g as t,i as p,z as q,f as u,_ as b,j as x,k as E,u as n,W as _,p as $,F as G,m as H,t as y,l as w}from"./app-oDzFbDpS.js";import{_ as J}from"./AppLayout.vue_vue_type_script_setup_true_lang-B8xcv65_.js";import{_ as S,a as C}from"./SelectInput-DixG2iKA.js";import{P}from"./plus-DaPcSaFA.js";import"./RovingFocusGroup-CLnOwjDo.js";import"./AvatarImage.vue_vue_type_script_setup_true_lang-DPNLz3sn.js";import"./AppLogo.vue_vue_type_script_setup_true_lang-Cob2K5o9.js";import"./building-2-Dp0U14zc.js";import"./users-DDnJbTSp.js";import"./school-T4gwIvXC.js";import"./chevron-down-SN-issHr.js";import"./check-CEIiCWnz.js";import"./Label.vue_vue_type_script_setup_true_lang-BphRAz40.js";import"./Input.vue_vue_type_script_setup_true_lang-CJXbLAqT.js";import"./InputError.vue_vue_type_script_setup_true_lang-DL9oimPF.js";const K={class:"max-w-7xl mx-auto w-full px-4 py-10"},Q={class:"bg-white dark:bg-neutral-900 rounded-lg shadow-md p-6"},X={class:"flex items-center justify-between mb-6"},Y={key:0,class:"text-center flex flex-col items-center gap-4 my-6 p-6 bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-300 dark:border-yellow-700 rounded-lg"},Z={key:1,class:"text-center flex flex-col items-center gap-4 my-6 p-6 bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-300 dark:border-yellow-700 rounded-lg"},ee={class:"grid grid-cols-1 md:grid-cols-4 gap-4"},se={key:0,class:"overflow-x-auto mt-6"},te={class:"w-full table-auto border-collapse"},ae={class:"p-2 text-sm"},le={class:"p-2 text-sm"},re={class:"p-2"},oe={class:"p-2"},de={class:"p-2"},ne={class:"p-2 text-sm"},ie=["onClick"],me={key:0,class:"w-24 h-24 overflow-hidden rounded border relative group"},pe=["src"],ue=["onClick"],ce={key:1,class:"text-gray-500 text-center text-xs px-2"},_e=["onChange"],ge={key:1,class:"text-center py-4 px-4 bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-300 dark:border-yellow-700 rounded-lg"},be={class:"flex justify-end space-x-3 mt-6"},xe={key:0},fe={key:1},he={key:2},Be=M({__name:"Create",props:{schools:{},classes:{},students:{},examPapers:{},selectedSchoolId:{},selectedClassId:{},selectedExamPaperId:{},noExamExists:{type:Boolean},noExamPapers:{type:Boolean}},setup(I){const d=I,g=z({}),a=A({school_id:d.selectedSchoolId?String(d.selectedSchoolId):"",class_id:d.selectedClassId?String(d.selectedClassId):"",exam_paper_id:d.selectedExamPaperId?String(d.selectedExamPaperId):"",results:d.students.map(l=>({student_id:l.id,obtained_marks:"",total_marks:"100",remarks:""}))}),V=L({});function U(l){const e=V[l];e&&e.click()}const h=O(()=>a.errors);function j(l,e){const s=l.target.files;if(s&&s.length>0){const r=s[0];a.results[e].images=[r],g.value[e]=[URL.createObjectURL(r)]}else a.results[e].images=[],g.value[e]=[]}function R(l){a.results[l].images=[],g.value[l]=[]}function F(){a.class_id="",a.exam_paper_id="",_.get(route("exam-results.create"),{school_id:a.school_id},{preserveState:!0,preserveScroll:!0,replace:!0})}function B(){a.exam_paper_id="",_.get(route("exam-results.create"),{school_id:a.school_id,class_id:a.class_id},{preserveState:!0,preserveScroll:!0,replace:!0})}function N(){_.get(route("exam-results.create"),{school_id:a.school_id,class_id:a.class_id,exam_paper_id:a.exam_paper_id},{preserveState:!0,preserveScroll:!0,replace:!0})}function D(){let l=!0;if(a.results.forEach(o=>{(!o.obtained_marks||!o.total_marks)&&(l=!1,w.error("Please enter all required marks."))}),!l)return;const e=new FormData;e.append("school_id",a.school_id),e.append("class_id",a.class_id),e.append("exam_paper_id",a.exam_paper_id),a.results.forEach((o,s)=>{var r;e.append(`results[${s}][student_id]`,String(o.student_id)),e.append(`results[${s}][obtained_marks]`,o.obtained_marks),e.append(`results[${s}][total_marks]`,o.total_marks),e.append(`results[${s}][remarks]`,o.remarks),(r=o.images)!=null&&r.length&&o.images.forEach((f,m)=>{e.append(`results[${s}][images][${m}]`,f)})}),_.post(route("exam-results.store"),e,{forceFormData:!0,onSuccess:()=>w.success("Results saved successfully!"),onError:o=>{Object.values(o).flat().forEach(s=>{typeof s=="string"&&w.error(s)})}})}T(()=>d.students,l=>{a.results=l.map(e=>({student_id:e.id,obtained_marks:"",total_marks:"100",remarks:"",images:[]}))},{immediate:!0});function k(l,e){const o=`results.${l}.${e}`;return a.errors[o]}return(l,e)=>{const o=W("can");return i(),v(J,null,{default:c(()=>[t("div",K,[t("div",Q,[t("div",X,[e[8]||(e[8]=t("h1",{class:"text-2xl font-bold text-gray-900 dark:text-gray-100"},"Enter Subject Exam Results",-1)),u(b,{variant:"outline",onClick:e[0]||(e[0]=s=>l.$inertia.visit(l.route("exam-results.index")))},{default:c(()=>e[7]||(e[7]=[x("Back")])),_:1,__:[7]})]),l.noExamExists?(i(),p("div",Y,[e[10]||(e[10]=t("span",null," ⚠️ No exam has been created for this class yet. Please schedule an exam before entering results.",-1)),E((i(),v(b,{variant:"default",size:"sm",class:"px-4 py-2 text-sm",onClick:e[1]||(e[1]=s=>n(_).visit(l.route("exams.index")))},{default:c(()=>[u(n(P),{class:"w-4 h-4 mr-2"}),e[9]||(e[9]=x(" Add Exams "))]),_:1,__:[9]})),[[o,"create-exams"]])])):l.noExamPapers?(i(),p("div",Z,[e[12]||(e[12]=t("span",null," ⚠️ The selected exam does not have any subjects added yet. Please add exam papers before entering results.",-1)),E((i(),v(b,{variant:"default",size:"sm",class:"px-4 py-2 text-sm",onClick:e[2]||(e[2]=s=>n(_).visit(l.route("exam-papers.index")))},{default:c(()=>[u(n(P),{class:"w-4 h-4 mr-2"}),e[11]||(e[11]=x(" Add Exam Paper "))]),_:1,__:[11]})),[[o,"create-exam-papers"]])])):q("",!0),t("form",{onSubmit:$(D,["prevent"]),class:"space-y-6"},[t("div",ee,[u(S,{id:"school_id",modelValue:n(a).school_id,"onUpdate:modelValue":e[3]||(e[3]=s=>n(a).school_id=s),label:"School",options:d.schools.map(s=>({label:s.name,value:String(s.id)})),placeholder:"Select School",error:h.value.school_id,onChange:F},null,8,["modelValue","options","error"]),u(S,{id:"class_id",modelValue:n(a).class_id,"onUpdate:modelValue":e[4]||(e[4]=s=>n(a).class_id=s),label:"Class",options:d.classes.map(s=>({label:s.name,value:String(s.id)})),placeholder:"Select Class",disabled:!n(a).school_id,error:h.value.class_id,onChange:B},null,8,["modelValue","options","disabled","error"]),u(S,{id:"exam_paper_id",modelValue:n(a).exam_paper_id,"onUpdate:modelValue":e[5]||(e[5]=s=>n(a).exam_paper_id=s),label:"Exam Paper",class:"col-span-2",options:d.examPapers.map(s=>({label:`${s.subject.name} - ${s.exam.title} `,value:String(s.id)})),placeholder:"Select Exam Paper",disabled:!n(a).class_id,error:h.value.exam_paper_id,onChange:N},null,8,["modelValue","options","disabled","error"])]),d.students.length?(i(),p("div",se,[t("table",te,[e[14]||(e[14]=t("thead",null,[t("tr",{class:"bg-gray-100 dark:bg-neutral-800 text-left"},[t("th",{class:"p-2 text-sm"},"#"),t("th",{class:"p-2 text-sm"},"Student"),t("th",{class:"p-2 text-sm flex border border-amber-300"},[x("Obtained Marks "),t("span",{class:"text-red-500"},"*")]),t("th",{class:"p-2 text-sm"},"Total Marks"),t("th",{class:"p-2 text-sm"},"Remarks"),t("th",{class:"p-2 text-sm"},"Paper Image(s)")])],-1)),t("tbody",null,[(i(!0),p(G,null,H(n(a).results,(s,r)=>{var f;return i(),p("tr",{key:r,class:"border-b dark:border-neutral-700"},[t("td",ae,y(r+1),1),t("td",le,y(d.students[r].name)+" (Reg# "+y(d.students[r].registration_number)+") ",1),t("td",re,[u(C,{modelValue:s.obtained_marks,"onUpdate:modelValue":m=>s.obtained_marks=m,type:"number",min:"0",class:"w-24",error:k(r,"obtained_marks"),placeholder:"Marks"},null,8,["modelValue","onUpdate:modelValue","error"])]),t("td",oe,[u(C,{modelValue:s.total_marks,"onUpdate:modelValue":m=>s.total_marks=m,type:"number",min:"0",class:"w-24",error:k(r,"total_marks"),placeholder:"100"},null,8,["modelValue","onUpdate:modelValue","error"])]),t("td",de,[u(C,{modelValue:s.remarks,"onUpdate:modelValue":m=>s.remarks=m,type:"text",class:"w-full",error:k(r,"remarks"),placeholder:"Remarks"},null,8,["modelValue","onUpdate:modelValue","error"])]),t("td",ne,[t("div",{class:"relative border-2 border-dashed rounded-md min-h-[100px] w-28 flex items-center justify-center cursor-pointer hover:border-blue-400 transition-all",onClick:m=>U(r)},[(f=g.value[r])!=null&&f.length?(i(),p("div",me,[t("img",{src:g.value[r][0],class:"w-full h-full object-cover",alt:"Preview"},null,8,pe),t("button",{type:"button",class:"absolute top-0 right-0 bg-black bg-opacity-50 text-white text-xs p-1 rounded-bl",onClick:$(m=>R(r),["stop"])}," ✕ ",8,ue)])):(i(),p("div",ce,e[13]||(e[13]=[t("p",null,[t("strong",null,"Upload")],-1),t("p",{class:"text-[10px] mt-1"},"Click to add image",-1)]))),t("input",{type:"file",accept:"image/*",class:"hidden",ref_for:!0,ref:m=>V[r]=m,onChange:m=>j(m,r)},null,40,_e)],8,ie)])])}),128))])])])):(i(),p("div",ge,e[15]||(e[15]=[t("p",{class:"text-yellow-700 dark:text-yellow-200 font-medium"},"⚠️ No Students Found",-1),t("p",{class:"text-yellow-600 dark:text-yellow-300 text-sm"},"Please select a class with admitted students.",-1)]))),t("div",be,[u(b,{type:"button",variant:"outline",onClick:e[6]||(e[6]=s=>l.$inertia.visit(l.route("exam-results.index")))},{default:c(()=>e[16]||(e[16]=[x(" Cancel ")])),_:1,__:[16]}),u(b,{type:"submit",disabled:n(a).processing||!d.students.length},{default:c(()=>[n(a).processing?(i(),p("span",xe,"Saving...")):d.students.length?(i(),p("span",he,"Save Results")):(i(),p("span",fe,"No Students Available"))]),_:1},8,["disabled"])])],32)])])]),_:1})}}});export{Be as default};
