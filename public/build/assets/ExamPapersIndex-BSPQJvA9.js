import{d as X,r as u,w as C,x as Y,c as Z,y as h,b as M,o as x,e as i,f as s,g as p,u as t,h as w,i as P,k as $,_ as k,j as m,F as ee,m as ae,t as d,A as te,E as T,B as N,C as q,p as re,D as A,l as f,W as y}from"./app-oDzFbDpS.js";import{_ as le}from"./BaseDataTable.vue_vue_type_style_index_0_lang-dE9UHpEE.js";import{_ as B}from"./DialogHeader.vue_vue_type_script_setup_true_lang-BpgOtXzy.js";import{_ as I}from"./Icon.vue_vue_type_script_setup_true_lang-CktM08l_.js";import{_ as se}from"./ManageLayout.vue_vue_type_script_setup_true_lang-3BtKD-jU.js";import{_ as F,a as g}from"./SelectInput-DixG2iKA.js";import"./loader-circle-Dd3mNCCo.js";import"./chevron-down-SN-issHr.js";import"./check-CEIiCWnz.js";import"./building-2-Dp0U14zc.js";import"./target-BvkpxWi2.js";import"./triangle-alert-DX_7JuLF.js";import"./refresh-cw-CWAu1Of8.js";import"./save-BhC_gGhx.js";import"./plus-DaPcSaFA.js";import"./arrow-right-Dpm9A9Fy.js";import"./arrow-left-DCJF3lDn.js";import"./eye-off-ByIEJSqi.js";import"./eye-DjBiqAnr.js";import"./shield-CQ-AXaLs.js";import"./square-pen-D5JRiJpv.js";import"./info-Cu4eEvQq.js";import"./calendar-NzJ3-Hzp.js";import"./house-CZga5bkn.js";import"./book-open-NJHJ4pEX.js";import"./trash-Byk8sBRk.js";import"./users-DDnJbTSp.js";import"./AppLayout.vue_vue_type_script_setup_true_lang-B8xcv65_.js";import"./RovingFocusGroup-CLnOwjDo.js";import"./AvatarImage.vue_vue_type_script_setup_true_lang-DPNLz3sn.js";import"./AppLogo.vue_vue_type_script_setup_true_lang-Cob2K5o9.js";import"./school-T4gwIvXC.js";import"./clipboard-list-BsqG52_M.js";import"./Label.vue_vue_type_script_setup_true_lang-BphRAz40.js";import"./Input.vue_vue_type_script_setup_true_lang-CJXbLAqT.js";import"./InputError.vue_vue_type_script_setup_true_lang-DL9oimPF.js";const ie={class:"max-w-6xl mx-auto w-full px-2 sm:px-4 md:px-0 py-5"},oe={class:"flex justify-between items-center mb-6"},me={class:"text-xl font-semibold text-neutral-800 dark:text-neutral-100 mb-4"},ne=["onClick"],de=["disabled","title","onClick"],ue={class:"grid grid-cols-1 sm:grid-cols-2 gap-4"},Re=X({__name:"ExamPapersIndex",props:{examPapers:{},exams:{},papers:{}},setup(z){const _=z,j=u([..._.examPapers]),S=u([..._.exams]),U=u([..._.papers]);C(()=>_.examPapers,r=>j.value=[...r]),C(()=>_.exams,r=>S.value=[...r]),C(()=>_.papers,r=>U.value=[...r]);const c=u(!1),v=u(!1),E=u(null),b=u(!1),V=u(null),e=Y({exam_id:void 0,paper_id:void 0,exam_date:"",start_time:"",end_time:"",total_marks:100,passing_marks:40}),O=[{text:"ID",value:"id"},{text:"Paper",value:"paper_name",slotName:"item-paper_name"},{text:"Subject",value:"subject_name",slotName:"item-subject_name"},{text:"Date",value:"exam_date"},{text:"Time",value:"time_range",slotName:"item-time_range"},{text:"Marks (Passing/Total)",value:"marks",slotName:"item-marks"},{text:"Actions",value:"actions",sortable:!1,slotName:"item-actions"}],W=Z(()=>{const r={};return j.value.forEach(a=>{const n=a.exam.id;r[n]||(r[n]={exam:a.exam,papers:[]}),r[n].papers.push(a)}),Object.values(r)});function L(){v.value=!1,E.value=null,e.reset(),e.clearErrors(),c.value=!0}function G(r){var a,n;v.value=!0,E.value=r,e.reset(),e.exam_id=r.exam_id??((a=r.exam)==null?void 0:a.id)??null,e.paper_id=r.paper_id??((n=r.paper)==null?void 0:n.id)??null,e.exam_date=r.exam_date,e.start_time=r.start_time??"",e.end_time=r.end_time??"",e.total_marks=r.total_marks,e.passing_marks=r.passing_marks,e.clearErrors(),c.value=!0}function D(){c.value=!1,e.reset(),e.clearErrors()}function H(){var r;v.value&&((r=E.value)!=null&&r.id)?e.put(`/exam-papers/${E.value.id}`,{onSuccess:()=>{f.success("Exam paper updated!"),D(),y.reload({only:["examPapers"]})},onError:()=>f.error("Validation failed.")}):e.post("/exam-papers",{onSuccess:()=>{f.success("Exam paper created!"),D(),y.reload({only:["examPapers"]})},onError:()=>f.error("Validation failed.")})}function J(r){V.value=r.value,b.value=!0}function K(){V.value&&(console.log("itemToDelete.value",V.value),e.processing=!0,y.delete(`/exam-papers/${V.value.id}`,{onSuccess:()=>{f.success("Exam paper deleted!"),b.value=!1,y.reload({only:["examPapers"]})},onError:()=>f.error("Deletion failed!"),onFinish:()=>e.processing=!1}))}function Q(){b.value=!1}return(r,a)=>{const n=h("can");return x(),M(se,null,{default:i(()=>[s(t(w),{title:"Exam Papers"}),p("div",ie,[p("div",oe,[a[10]||(a[10]=p("h1",{class:"text-2xl font-bold text-neutral-900 dark:text-neutral-100"},"Exam Papers",-1)),$((x(),M(t(k),{variant:"default",size:"lg",onClick:L},{default:i(()=>a[9]||(a[9]=[m(" Add Exam Paper ")])),_:1,__:[9]})),[[n,"create-exam-papers"]])]),(x(!0),P(ee,null,ae(W.value,l=>(x(),P("div",{key:l.exam.id,class:"mb-10"},[p("h2",me,d(l.exam.title),1),s(le,{headers:O,items:l.papers,loading:t(e).processing,class:"bg-white dark:bg-neutral-900 rounded-xl shadow border border-gray-200 dark:border-neutral-700"},{"item-paper_name":i(o=>[m(d(o.paper.title),1)]),"item-subject_name":i(o=>[m(d(o.subject.name),1)]),"item-exam_date":i(o=>[m(d(o.exam_date),1)]),"item-time_range":i(o=>[m(d(o.start_time??"—")+" – "+d(o.end_time??"—"),1)]),"item-marks":i(o=>[m(d(o.passing_marks)+" / "+d(o.total_marks),1)]),"item-actions":i(o=>[$((x(),P("button",{class:"inline-flex items-center justify-center rounded-full p-2 text-blue-500 focus:outline-none focus:ring-2 focus:ring-blue-400 mr-1",onClick:R=>G(o),title:"Edit","aria-label":"Edit Exam Paper"},[s(I,{name:"edit",class:"w-5 h-5"})],8,ne)),[[n,"update-exam-papers"]]),$((x(),P("button",{disabled:!o.can_be_deleted,class:te(["inline-flex items-center justify-center rounded-full p-2",o.can_be_deleted?"text-red-500 focus:ring-2 focus:ring-red-400":"text-red-300 cursor-not-allowed"]),title:o.can_be_deleted?"Delete Exam Paper":`${o.exam_results_count} result(s) linked. Cannot delete.`,onClick:R=>o.can_be_deleted&&J(o),"aria-label":"Delete Exam Paper"},[s(I,{name:"trash",class:"w-5 h-5"})],10,de)),[[n,"delete-exam-papers"]])]),_:2},1032,["items","loading"])]))),128))]),s(t(T),{open:c.value,"onUpdate:open":a[7]||(a[7]=l=>c.value=l)},{default:i(()=>[s(t(N),null,{default:i(()=>[s(t(B),null,{default:i(()=>[s(t(q),null,{default:i(()=>[m(d(v.value?"Edit Exam Paper":"Add Exam Paper"),1)]),_:1})]),_:1}),p("form",{onSubmit:re(H,["prevent"]),class:"space-y-6"},[s(F,{id:"exam_id",modelValue:t(e).exam_id,"onUpdate:modelValue":a[0]||(a[0]=l=>t(e).exam_id=l),label:"Exam",required:"",options:S.value.map(l=>({label:l.title,value:l.id})),placeholder:"Select Exam",error:t(e).errors.exam_id},null,8,["modelValue","options","error"]),s(F,{id:"paper_id",modelValue:t(e).paper_id,"onUpdate:modelValue":a[1]||(a[1]=l=>t(e).paper_id=l),label:"Paper",required:"",options:U.value.map(l=>({label:l.title,value:l.id})),placeholder:"Select Paper",error:t(e).errors.paper_id},null,8,["modelValue","options","error"]),p("div",ue,[s(g,{id:"exam_date",modelValue:t(e).exam_date,"onUpdate:modelValue":a[2]||(a[2]=l=>t(e).exam_date=l),label:"Exam Date",type:"date",required:"",error:t(e).errors.exam_date},null,8,["modelValue","error"]),s(g,{id:"start_time",modelValue:t(e).start_time,"onUpdate:modelValue":a[3]||(a[3]=l=>t(e).start_time=l),label:"Start Time",type:"time",required:"",error:t(e).errors.start_time},null,8,["modelValue","error"]),s(g,{id:"end_time",modelValue:t(e).end_time,"onUpdate:modelValue":a[4]||(a[4]=l=>t(e).end_time=l),label:"End Time",type:"time",required:"",error:t(e).errors.end_time},null,8,["modelValue","error"]),s(g,{id:"total_marks",modelValue:t(e).total_marks,"onUpdate:modelValue":a[5]||(a[5]=l=>t(e).total_marks=l),modelModifiers:{number:!0},label:"Total Marks",type:"number",required:"",error:t(e).errors.total_marks},null,8,["modelValue","error"]),s(g,{id:"passing_marks",modelValue:t(e).passing_marks,"onUpdate:modelValue":a[6]||(a[6]=l=>t(e).passing_marks=l),modelModifiers:{number:!0},label:"Passing Marks",required:"",type:"number",error:t(e).errors.passing_marks},null,8,["modelValue","error"])]),s(t(A),{class:"mt-4"},{default:i(()=>[s(t(k),{type:"button",variant:"outline",onClick:D},{default:i(()=>a[11]||(a[11]=[m("Cancel")])),_:1,__:[11]}),s(t(k),{type:"submit",disabled:t(e).processing},{default:i(()=>[m(d(v.value?"Update":"Create"),1)]),_:1},8,["disabled"])]),_:1})],32)]),_:1})]),_:1},8,["open"]),s(t(T),{open:b.value,"onUpdate:open":a[8]||(a[8]=l=>b.value=l)},{default:i(()=>[s(t(N),null,{default:i(()=>[s(t(B),null,{default:i(()=>[s(t(q),null,{default:i(()=>a[12]||(a[12]=[m("Delete Exam Paper?")])),_:1,__:[12]})]),_:1}),a[15]||(a[15]=p("div",{class:"mb-4"},"Are you sure you want to delete this exam paper? This cannot be undone.",-1)),s(t(A),null,{default:i(()=>[s(t(k),{variant:"outline",onClick:Q},{default:i(()=>a[13]||(a[13]=[m("Cancel")])),_:1,__:[13]}),s(t(k),{variant:"destructive",onClick:K},{default:i(()=>a[14]||(a[14]=[m("Delete")])),_:1,__:[14]})]),_:1})]),_:1,__:[15]})]),_:1},8,["open"])]),_:1})}}});export{Re as default};
