import{a_ as m,r as i,w as p,a as y,s as w}from"./app-oDzFbDpS.js";const J=m("school",()=>{const a=i([]),o=i(null),r=i([]),n=i([]);async function t(){try{const{data:e}=await y.get("/admin/schools");e.schools&&(a.value=e.schools);const s=w().props.activeSchool;a.value.length===0?(o.value=null,localStorage.removeItem("selectedSchool")):s&&a.value.some(l=>l.id===s.id)?(o.value=s,localStorage.setItem("selectedSchool",JSON.stringify(s))):(!o.value||!a.value.some(l=>{var S;return l.id===((S=o.value)==null?void 0:S.id)}))&&(o.value=a.value[0],localStorage.setItem("selectedSchool",JSON.stringify(a.value[0]))),u()}catch(e){console.error("Error fetching schools:",e);const c=localStorage.getItem("selectedSchool");if(c)try{o.value=JSON.parse(c)}catch(s){console.error("Error parsing cached school:",s)}}}async function h(){await t()}async function f(){await t()}async function v(){await t()}function d(e){o.value=e,e?localStorage.setItem("selectedSchool",JSON.stringify(e)):localStorage.removeItem("selectedSchool"),u()}function g(){const e=localStorage.getItem("selectedSchool");e&&(o.value=JSON.parse(e))}function u(){if(!o.value||!o.value.id){r.value=[],n.value=[];return}const e=a.value.find(c=>{var s;return c.id===((s=o.value)==null?void 0:s.id)});if(e&&e.classes){r.value=e.classes;const c=e.classes.flatMap(l=>l.sections||[]),s=Array.from(new Map(c.map(l=>[l.id,l])).values());n.value=s}else r.value=[],n.value=[]}return t(),g(),p(o,()=>{u()}),{schools:a,selectedSchool:o,fetchSchools:t,setSchool:d,classes:r,sections:n,refreshSchools:h,refreshClasses:f,refreshSections:v}});export{J as u};
